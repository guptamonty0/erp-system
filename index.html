<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Resource Planning System</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #0F172A;
            --primary-light: #1E293B;
            --secondary: #3B82F6;
            --accent: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --bg: #F8FAFC;
            --surface: #FFFFFF;
            --text: #1E293B;
            --text-light: #64748B;
            --border: #E2E8F0;
            --shadow: rgba(15, 23, 42, 0.08);
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: var(--primary);
            color: white;
            padding: 0;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #60A5FA, #A78BFA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            padding: 0 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .nav-item.active {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary);
            border-left: 3px solid var(--secondary);
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            margin-right: 12px;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 16px;
            width: 400px;
        }

        .search-bar input {
            border: none;
            background: none;
            outline: none;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            width: 100%;
            margin-left: 8px;
        }

        .header-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: none;
            background: var(--bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            position: relative;
        }

        .icon-btn:hover {
            background: var(--border);
        }

        .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-profile:hover {
            background: var(--bg);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Content Container */
        .content {
            padding: 32px;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-light);
            font-size: 14px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px var(--shadow);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.blue {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary);
        }

        .stat-icon.green {
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent);
        }

        .stat-icon.orange {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .stat-icon.red {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            font-weight: 600;
        }

        .stat-change.positive {
            color: var(--accent);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Data Table */
        .table-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 32px;
        }

        .table-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: #2563EB;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead th {
            text-align: left;
            padding: 16px 24px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-light);
            border-bottom: 1px solid var(--border);
            background: var(--bg);
        }

        tbody td {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--bg);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent);
        }

        .status-badge.pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status-badge.danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        /* Chart Container */
        .chart-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .chart-header {
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .chart-subtitle {
            font-size: 13px;
            color: var(--text-light);
        }

        .chart {
            height: 300px;
            display: flex;
            align-items: flex-end;
            gap: 12px;
            padding: 20px 0;
        }

        .chart-bar {
            flex: 1;
            background: var(--gradient);
            border-radius: 6px 6px 0 0;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .chart-bar:hover {
            opacity: 0.8;
            transform: translateY(-4px);
        }

        .chart-label {
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 8px;
            font-weight: 500;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            background: var(--bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--border);
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        select.form-input {
            cursor: pointer;
        }

        textarea.form-input {
            resize: vertical;
            min-height: 100px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Grid Layout */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: none;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            color: var(--secondary);
            border-bottom-color: var(--secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .search-bar {
                width: 200px;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-light);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: var(--bg);
            border-color: var(--secondary);
        }

        /* Tutorial/Practice Mode Styles */
        .tutorial-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tutorial-content {
            flex: 1;
        }

        .tutorial-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .tutorial-desc {
            opacity: 0.9;
            font-size: 14px;
        }

        .tutorial-actions {
            display: flex;
            gap: 12px;
        }

        .tutorial-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .tutorial-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .practice-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .practice-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .practice-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px var(--shadow);
            border-color: var(--secondary);
        }

        .practice-card:hover::before {
            transform: scaleX(1);
        }

        .practice-card.completed {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.05);
        }

        .practice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .practice-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
        }

        .practice-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .practice-badge.beginner {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }

        .practice-badge.intermediate {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .practice-badge.advanced {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .practice-desc {
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .practice-meta {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: var(--text-light);
        }

        .practice-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .achievement-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-card.unlocked {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(16, 185, 129, 0.1));
        }

        .achievement-card.locked {
            opacity: 0.5;
        }

        .achievement-icon {
            font-size: 48px;
            margin-bottom: 12px;
            filter: grayscale(100%);
        }

        .achievement-card.unlocked .achievement-icon {
            filter: grayscale(0%);
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .achievement-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .achievement-desc {
            font-size: 12px;
            color: var(--text-light);
        }

        .scenario-step {
            background: var(--surface);
            border: 1px solid var(--border);
            border-left: 4px solid var(--secondary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .scenario-step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .scenario-step-number {
            background: var(--secondary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .scenario-step-title {
            flex: 1;
            margin-left: 16px;
            font-weight: 600;
            font-size: 16px;
        }

        .scenario-step-content {
            color: var(--text-light);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .scenario-actions {
            display: flex;
            gap: 12px;
        }

        /* Knowledge Base Styles */
        .kb-search-container {
            position: relative;
            margin-bottom: 24px;
        }

        .kb-search-container input {
            width: 100%;
            padding: 16px 20px 16px 52px;
            border: 2px solid var(--border);
            border-radius: 14px;
            background: var(--surface);
            font-size: 15px;
            color: var(--text);
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .kb-search-container input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .kb-search-container .kb-search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .kb-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 28px;
        }

        .kb-category-pill {
            padding: 8px 20px;
            border-radius: 100px;
            border: 2px solid var(--border);
            background: var(--surface);
            color: var(--text-light);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .kb-category-pill:hover {
            border-color: var(--secondary);
            color: var(--secondary);
            transform: translateY(-1px);
        }

        .kb-category-pill.active {
            background: var(--secondary);
            border-color: var(--secondary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .kb-category-pill .pill-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 1px 8px;
            border-radius: 100px;
            font-size: 11px;
        }

        .kb-category-pill.active .pill-count {
            background: rgba(255, 255, 255, 0.25);
        }

        .kb-article-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 0;
            margin-bottom: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .kb-article-card:hover {
            border-color: var(--secondary);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.08);
            transform: translateY(-2px);
        }

        .kb-article-card.expanded {
            border-color: var(--secondary);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.12);
        }

        .kb-article-header {
            display: flex;
            align-items: center;
            padding: 20px 24px;
            gap: 16px;
        }

        .kb-article-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            flex-shrink: 0;
        }

        .kb-article-info {
            flex: 1;
            min-width: 0;
        }

        .kb-article-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .kb-article-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-light);
        }

        .kb-article-meta .kb-tag {
            padding: 2px 10px;
            border-radius: 100px;
            font-weight: 600;
            font-size: 11px;
        }

        .kb-tag-beginner {
            background: #dcfce7;
            color: #16a34a;
        }

        .kb-tag-intermediate {
            background: #fef3c7;
            color: #d97706;
        }

        .kb-tag-advanced {
            background: #fce7f3;
            color: #db2777;
        }

        .kb-read-time {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .kb-article-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .kb-bookmark-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-light);
            padding: 6px;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 18px;
        }

        .kb-bookmark-btn:hover {
            color: var(--secondary);
            background: var(--bg);
        }

        .kb-bookmark-btn.bookmarked {
            color: #f59e0b;
        }

        .kb-expand-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-light);
            padding: 6px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .kb-expand-btn:hover {
            color: var(--secondary);
            background: var(--bg);
        }

        .kb-expand-btn.expanded svg {
            transform: rotate(180deg);
        }

        .kb-article-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.3s ease;
        }

        .kb-article-card.expanded .kb-article-body {
            max-height: 800px;
            padding: 0 24px 24px 24px;
        }

        .kb-article-content {
            border-top: 1px solid var(--border);
            padding-top: 20px;
            color: var(--text-light);
            font-size: 14px;
            line-height: 1.8;
        }

        .kb-article-content h4 {
            color: var(--text);
            font-size: 15px;
            margin: 16px 0 8px;
        }

        .kb-article-content h4:first-child {
            margin-top: 0;
        }

        .kb-article-content ul {
            padding-left: 20px;
            margin: 8px 0;
        }

        .kb-article-content ul li {
            margin-bottom: 6px;
        }

        .kb-article-content .kb-tip-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(168, 85, 247, 0.06));
            border-left: 4px solid var(--secondary);
            border-radius: 0 10px 10px 0;
            padding: 14px 18px;
            margin: 16px 0;
            font-size: 13px;
        }

        .kb-article-content .kb-warning-box {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(249, 115, 22, 0.06));
            border-left: 4px solid #f59e0b;
            border-radius: 0 10px 10px 0;
            padding: 14px 18px;
            margin: 16px 0;
            font-size: 13px;
        }

        .kb-related-nav {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .kb-related-link {
            padding: 6px 14px;
            border-radius: 8px;
            background: var(--bg);
            color: var(--secondary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .kb-related-link:hover {
            background: var(--secondary);
            color: white;
        }

        .kb-stats-strip {
            display: flex;
            gap: 16px;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }

        .kb-stat-chip {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            flex: 1;
            min-width: 160px;
        }

        .kb-stat-chip .kb-stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .kb-stat-chip .kb-stat-info .kb-stat-val {
            font-size: 20px;
            font-weight: 800;
            color: var(--text);
        }

        .kb-stat-chip .kb-stat-info .kb-stat-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .kb-no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .kb-no-results .kb-no-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .kb-no-results h3 {
            color: var(--text);
            margin-bottom: 8px;
        }

        .kb-highlight {
            background: rgba(99, 102, 241, 0.15);
            padding: 1px 2px;
            border-radius: 2px;
        }

        /* Company Sandbox Styles */
        .sandbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .sandbox-company-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .sandbox-company-card:hover {
            border-color: var(--secondary);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.12);
            transform: translateY(-4px);
        }

        .sandbox-company-card.active-sandbox {
            border-color: #10b981;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15);
        }

        .sandbox-company-card.active-sandbox::after {
            content: 'âœ“ ACTIVE';
            position: absolute;
            top: 16px;
            right: 16px;
            background: #10b981;
            color: white;
            font-size: 11px;
            font-weight: 800;
            padding: 4px 12px;
            border-radius: 100px;
            letter-spacing: 0.5px;
            z-index: 2;
        }

        .sandbox-card-header {
            padding: 28px 24px 20px;
            position: relative;
        }

        .sandbox-card-header .sandbox-logo {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .sandbox-card-header h3 {
            font-size: 20px;
            font-weight: 800;
            color: white;
            margin-bottom: 4px;
        }

        .sandbox-card-header .sandbox-industry {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .sandbox-card-body {
            padding: 20px 24px;
        }

        .sandbox-card-body .sandbox-desc {
            font-size: 13px;
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .sandbox-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .sandbox-stat-item {
            background: var(--bg);
            border-radius: 10px;
            padding: 12px 14px;
        }

        .sandbox-stat-item .sandbox-stat-val {
            font-size: 16px;
            font-weight: 800;
            color: var(--text);
        }

        .sandbox-stat-item .sandbox-stat-lbl {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 2px;
        }

        .sandbox-card-footer {
            padding: 0 24px 24px;
            display: flex;
            gap: 10px;
        }

        .sandbox-load-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sandbox-load-btn.primary {
            background: var(--secondary);
            color: white;
        }

        .sandbox-load-btn.primary:hover {
            background: #4f46e5;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .sandbox-load-btn.outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text);
        }

        .sandbox-load-btn.outline:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .sandbox-active-banner {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.05));
            border: 2px solid rgba(16, 185, 129, 0.2);
            border-radius: 14px;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .sandbox-active-banner .sandbox-active-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .sandbox-active-banner .sandbox-active-info h4 {
            font-size: 15px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 2px;
        }

        .sandbox-active-banner .sandbox-active-info p {
            font-size: 12px;
            color: var(--text-light);
        }

        .sandbox-active-banner .sandbox-reset-btn {
            margin-left: auto;
            padding: 8px 20px;
            border: 2px solid #ef4444;
            background: transparent;
            color: #ef4444;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sandbox-active-banner .sandbox-reset-btn:hover {
            background: #ef4444;
            color: white;
        }

        .sandbox-tag-row {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .sandbox-tag {
            padding: 3px 10px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        .progress-bar {
            height: 8px;
            background: var(--bg);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-light);
            font-weight: 600;
        }

        .hint-box {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .hint-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 8px;
        }

        .hint-content {
            font-size: 14px;
            color: var(--text);
            line-height: 1.6;
        }

        .floating-help {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .floating-help:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .notification-toast {
            position: fixed;
            top: 80px;
            right: 24px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 8px 24px var(--shadow);
            z-index: 2000;
            min-width: 300px;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-title {
            font-weight: 600;
            font-size: 14px;
        }

        .notification-message {
            color: var(--text-light);
            font-size: 13px;
        }

        .quiz-option {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quiz-option:hover {
            border-color: var(--secondary);
            background: var(--bg);
        }

        .quiz-option.selected {
            border-color: var(--secondary);
            background: rgba(59, 130, 246, 0.05);
        }

        .quiz-option.correct {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.05);
        }

        .quiz-option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }

        .learning-path {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        .learning-path::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 40px;
            bottom: 40px;
            width: 2px;
            background: var(--border);
        }

        .path-item {
            display: flex;
            gap: 16px;
            position: relative;
        }

        .path-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--surface);
            border: 3px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            z-index: 1;
        }

        .path-marker.completed {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .path-marker.current {
            background: var(--secondary);
            border-color: var(--secondary);
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .path-content {
            flex: 1;
            padding-bottom: 20px;
        }

        /* Analytics Dashboard Styles */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .chart-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            box-shadow: 0 8px 20px var(--shadow);
            transform: translateY(-2px);
        }

        .chart-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .chart-card-subtitle {
            font-size: 13px;
            color: var(--text-light);
            margin-top: 4px;
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .donut-chart {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        .donut-segment {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .donut-segment:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .line-chart-container {
            height: 250px;
            position: relative;
            padding: 20px 0;
        }

        .line-chart {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .chart-grid-line {
            position: absolute;
            width: 100%;
            height: 1px;
            background: var(--border);
            left: 0;
        }

        .chart-point {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--secondary);
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 2;
        }

        .chart-point:hover {
            width: 14px;
            height: 14px;
            background: var(--accent);
        }

        .chart-tooltip {
            position: absolute;
            background: var(--primary);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 10;
            white-space: nowrap;
        }

        .chart-point:hover+.chart-tooltip {
            opacity: 1;
        }

        .bar-chart-horizontal {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 10px 0;
        }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bar-label {
            min-width: 120px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text);
        }

        .bar-track {
            flex: 1;
            height: 32px;
            background: var(--bg);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 6px;
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .bar-value {
            font-size: 12px;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .metric-comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            padding: 20px;
            background: var(--bg);
            border-radius: 8px;
        }

        .metric-side {
            text-align: center;
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 28px;
            font-weight: 700;
        }

        .metric-divider {
            width: 2px;
            height: 60px;
            background: var(--border);
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .trend-up {
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent);
        }

        .trend-down {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .trend-neutral {
            background: rgba(100, 116, 139, 0.1);
            color: var(--text-light);
        }

        .mini-chart {
            width: 100%;
            height: 60px;
            display: flex;
            align-items: flex-end;
            gap: 4px;
            padding: 8px;
            background: var(--bg);
            border-radius: 6px;
        }

        .mini-bar {
            flex: 1;
            background: var(--gradient);
            border-radius: 2px;
            min-height: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .mini-bar:hover {
            opacity: 0.7;
        }

        .gauge-chart {
            width: 180px;
            height: 180px;
            margin: 0 auto;
            position: relative;
        }

        .gauge-background {
            fill: none;
            stroke: var(--bg);
            stroke-width: 20;
        }

        .gauge-fill {
            fill: none;
            stroke: url(#gaugeGradient);
            stroke-width: 20;
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease;
        }

        .gauge-text {
            font-size: 32px;
            font-weight: 700;
            fill: var(--text);
        }

        .gauge-label {
            font-size: 12px;
            fill: var(--text-light);
        }

        .heatmap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 16px;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .analytics-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--surface);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background: var(--bg);
        }

        .filter-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">âš¡ ERP System</div>
        </div>
        <nav class="nav-menu">
            <div class="nav-section">
                <div class="nav-section-title">Main</div>
                <div class="nav-item active" data-page="dashboard">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    Dashboard
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">ðŸŽ“ Learning</div>
                <div class="nav-item" data-page="practice">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    Practice Scenarios
                </div>
                <div class="nav-item" data-page="learning-path">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                    </svg>
                    Learning Path
                </div>
                <div class="nav-item" data-page="achievements">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                    </svg>
                    Achievements
                </div>
                <div class="nav-item" data-page="knowledge-base">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    Knowledge Base
                </div>
                <div class="nav-item" data-page="sandbox">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    Company Sandbox
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Operations</div>
                <div class="nav-item" data-page="inventory">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                    </svg>
                    Inventory
                </div>
                <div class="nav-item" data-page="sales">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    Sales
                </div>
                <div class="nav-item" data-page="purchases">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    Purchases
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Resources</div>
                <div class="nav-item" data-page="hr">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    Human Resources
                </div>
                <div class="nav-item" data-page="finance">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Finance
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">System</div>
                <div class="nav-item" data-page="analytics">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    Analytics Dashboard
                </div>
                <div class="nav-item" data-page="reports">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Reports
                </div>
                <div class="nav-item" data-page="settings">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Settings
                </div>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="search-bar">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input type="text" placeholder="Search anything... (Press Enter)" onkeyup="handleGlobalSearch(event)">
            </div>
            <div class="header-actions">
                <button class="icon-btn"
                    onclick="showNotification('Notifications', 'You have 3 unread messages from system.')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                    <span class="badge">3</span>
                </button>
                <button class="icon-btn">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                    </svg>
                </button>
                <div class="user-profile" onclick="loadPage('settings')">
                    <div class="user-avatar">AD</div>
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">Admin User</div>
                        <div style="font-size: 12px; color: var(--text-light);">Administrator</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Content Container -->
        <div id="pageContent" class="content">
            <!-- Dynamic content will be loaded here -->
        </div>
    </div>

    <!-- Floating Help Button -->
    <div class="floating-help" onclick="showHelp()" title="Need help? Click here!">
        ðŸ’¡
    </div>

    <!-- Modal Template -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Modal Title</h3>
                <button class="close-btn" onclick="closeModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic modal content -->
            </div>
        </div>
    </div>

    <!-- Scenario Widget -->
    <div id="scenarioWidget" style="position: fixed; bottom: 24px; left: 24px; z-index: 1000;"></div>

    <script>
        // Currency Formatter
        function formatCurrency(amount) {
            return 'â‚¹' + amount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // Data Storage
        const appData = {
            inventory: JSON.parse(localStorage.getItem('inventory')) || [
                { id: 1, name: 'Laptop Dell XPS 15', sku: 'LAP-001', hsnCode: '8471', gstRate: 18, quantity: 45, price: 108000.00, category: 'Electronics', status: 'In Stock' },
                { id: 2, name: 'Office Chair Premium', sku: 'FUR-002', hsnCode: '9401', gstRate: 18, quantity: 12, price: 29000.00, category: 'Furniture', status: 'Low Stock' },
                { id: 3, name: 'Wireless Mouse', sku: 'ACC-003', hsnCode: '8471', gstRate: 18, quantity: 150, price: 2500.00, category: 'Accessories', status: 'In Stock' },
                { id: 4, name: 'USB-C Hub', sku: 'ACC-004', hsnCode: '8473', gstRate: 18, quantity: 5, price: 4200.00, category: 'Accessories', status: 'Critical' },
                { id: 5, name: 'Monitor 27" 4K', sku: 'MON-005', hsnCode: '8528', gstRate: 18, quantity: 28, price: 37500.00, category: 'Electronics', status: 'In Stock' }
            ],
            sales: JSON.parse(localStorage.getItem('sales')) || [
                { id: 1, orderNumber: 'SO-2024-001', customer: 'Acme Corp', amount: 1285000.00, gstRate: 18, taxableAmount: 1089406.78, cgst: 98046.61, sgst: 98046.61, totalWithGst: 1285000.00, date: '2024-02-15', status: 'Completed' },
                { id: 2, orderNumber: 'SO-2024-002', customer: 'Tech Solutions Inc', amount: 685000.00, gstRate: 18, taxableAmount: 580508.47, cgst: 52245.76, sgst: 52245.76, totalWithGst: 685000.00, date: '2024-02-14', status: 'Pending' },
                { id: 3, orderNumber: 'SO-2024-003', customer: 'Global Enterprises', amount: 1835000.00, gstRate: 18, taxableAmount: 1555084.75, cgst: 139957.63, sgst: 139957.63, totalWithGst: 1835000.00, date: '2024-02-13', status: 'Completed' },
                { id: 4, orderNumber: 'SO-2024-004', customer: 'Start-up Hub', amount: 465000.00, gstRate: 18, taxableAmount: 394067.80, cgst: 35466.10, sgst: 35466.10, totalWithGst: 465000.00, date: '2024-02-12', status: 'Processing' },
                { id: 5, orderNumber: 'SO-2024-005', customer: 'Innovation Labs', amount: 1555000.00, gstRate: 18, taxableAmount: 1317796.61, cgst: 118601.69, sgst: 118601.69, totalWithGst: 1555000.00, date: '2024-02-11', status: 'Completed' }
            ],
            purchases: JSON.parse(localStorage.getItem('purchases')) || [
                { id: 1, poNumber: 'PO-2024-001', supplier: 'Dell Technologies', amount: 3740000.00, gstRate: 18, taxableAmount: 3169491.53, cgst: 285254.24, sgst: 285254.24, totalWithGst: 3740000.00, date: '2024-02-10', status: 'Received' },
                { id: 2, poNumber: 'PO-2024-002', supplier: 'Office Depot', amount: 740000.00, gstRate: 18, taxableAmount: 627118.64, cgst: 56440.68, sgst: 56440.68, totalWithGst: 740000.00, date: '2024-02-08', status: 'Pending' },
                { id: 3, poNumber: 'PO-2024-003', supplier: 'Tech Wholesale', amount: 1040000.00, gstRate: 18, taxableAmount: 881355.93, cgst: 79322.03, sgst: 79322.03, totalWithGst: 1040000.00, date: '2024-02-05', status: 'Received' }
            ],
            employees: JSON.parse(localStorage.getItem('employees')) || [
                { id: 1, name: 'John Smith', position: 'Sales Manager', department: 'Sales', salary: 6225000, email: 'john.smith@company.com', status: 'Active' },
                { id: 2, name: 'Sarah Johnson', position: 'HR Director', department: 'HR', salary: 7055000, email: 'sarah.j@company.com', status: 'Active' },
                { id: 3, name: 'Michael Chen', position: 'Software Engineer', department: 'IT', salary: 7885000, email: 'michael.c@company.com', status: 'Active' },
                { id: 4, name: 'Emily Davis', position: 'Marketing Specialist', department: 'Marketing', salary: 5395000, email: 'emily.d@company.com', status: 'Active' }
            ]
        };

        // Save data to localStorage
        function saveData(key) {
            localStorage.setItem(key, JSON.stringify(appData[key]));
        }

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function () {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                const page = this.getAttribute('data-page');
                loadPage(page);
            });
        });

        // Page Loader
        function loadPage(page) {
            const content = document.getElementById('pageContent');
            content.innerHTML = '';
            content.classList.add('fade-in');

            switch (page) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'sales':
                    loadSales();
                    break;
                case 'purchases':
                    loadPurchases();
                    break;
                case 'hr':
                    loadHR();
                    break;
                case 'finance':
                    loadFinance();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // Dashboard Page
        function loadDashboard() {
            const totalRevenue = appData.sales.reduce((sum, sale) => sum + sale.amount, 0);
            const totalInventoryValue = appData.inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            const lowStockItems = appData.inventory.filter(item => item.quantity < 20).length;

            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Welcome back! Here's what's happening with your business today.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">ðŸ’°</div>
                        </div>
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value">${formatCurrency(totalRevenue)}</div>
                        <div class="stat-change positive">
                            <span>â†‘</span> 12.5% from last month
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">ðŸ“¦</div>
                        </div>
                        <div class="stat-label">Inventory Value</div>
                        <div class="stat-value">${formatCurrency(totalInventoryValue)}</div>
                        <div class="stat-change positive">
                            <span>â†‘</span> 8.2% increase
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">âš ï¸</div>
                        </div>
                        <div class="stat-label">Low Stock Alerts</div>
                        <div class="stat-value">${lowStockItems}</div>
                        <div class="stat-change negative">
                            <span>â†‘</span> Requires attention
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">ðŸ‘¥</div>
                        </div>
                        <div class="stat-label">Active Employees</div>
                        <div class="stat-value">${appData.employees.length}</div>
                        <div class="stat-change positive">
                            <span>â†’</span> Stable workforce
                        </div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Monthly Sales</h3>
                            <p class="chart-subtitle">Revenue trend over the last 6 months</p>
                        </div>
                        <div class="chart">
                            <div style="flex: 1;">
                                <div class="chart-bar" style="height: 60%;"></div>
                                <div class="chart-label">Jan</div>
                            </div>
                            <div style="flex: 1;">
                                <div class="chart-bar" style="height: 75%;"></div>
                                <div class="chart-label">Feb</div>
                            </div>
                            <div style="flex: 1;">
                                <div class="chart-bar" style="height: 85%;"></div>
                                <div class="chart-label">Mar</div>
                            </div>
                            <div style="flex: 1;">
                                <div class="chart-bar" style="height: 70%;"></div>
                                <div class="chart-label">Apr</div>
                            </div>
                            <div style="flex: 1;">
                                <div class="chart-bar" style="height: 90%;"></div>
                                <div class="chart-label">May</div>
                            </div>
                            <div style="flex: 1;">
                                <div class="chart-bar" style="height: 100%;"></div>
                                <div class="chart-label">Jun</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Recent Sales</h3>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Order</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${appData.sales.slice(0, 5).map(sale => `
                                    <tr>
                                        <td>${sale.orderNumber}</td>
                                        <td>${sale.customer}</td>
                                        <td>${formatCurrency(sale.amount)}</td>
                                        <td>
                                            <span class="status-badge ${sale.status === 'Completed' ? 'success' : 'pending'}">
                                                ${sale.status}
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Inventory Page
        function loadInventory() {
            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Inventory Management</h1>
                    <p class="page-subtitle">Manage your products, stock levels, and inventory</p>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Products</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary" onclick="toggleLowStockFilter(this)">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                                </svg>
                                Filter Low Stock
                            </button>
                            <button class="btn btn-primary" onclick="openInventoryModal()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                Add Product
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>SKU</th>
                                <th>HSN Code</th>
                                <th>Category</th>
                                <th>Qty</th>
                                <th>Price</th>
                                <th>GST %</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            ${renderInventoryTable()}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderInventoryTable(data = appData.inventory) {
            return data.map(item => `
                <tr>
                    <td style="font-weight: 600;">${item.name}</td>
                    <td>${item.sku}</td>
                    <td><code style="background: var(--bg); padding: 2px 8px; border-radius: 4px; font-size: 12px;">${item.hsnCode || 'â€”'}</code></td>
                    <td>${item.category}</td>
                    <td>${item.quantity}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td><span style="color: var(--secondary); font-weight: 600;">${item.gstRate || 0}%</span></td>
                    <td>
                        <span class="status-badge ${item.quantity > 20 ? 'success' :
                    item.quantity > 10 ? 'pending' : 'danger'
                }">
                            ${item.status}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="editInventoryItem(${item.id})" title="Edit">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </button>
                            <button class="action-btn" onclick="deleteInventoryItem(${item.id})" title="Delete">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function openInventoryModal(itemId = null) {
            const item = itemId ? appData.inventory.find(i => i.id === itemId) : null;
            const modalTitle = item ? 'Edit Product' : 'Add New Product';

            document.getElementById('modalTitle').textContent = modalTitle;
            document.getElementById('modalBody').innerHTML = `
                <form id="inventoryForm" onsubmit="saveInventoryItem(event, ${itemId})">
                    <div class="form-group">
                        <label class="form-label">Product Name</label>
                        <input type="text" class="form-input" name="name" value="${item?.name || ''}" required>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">SKU</label>
                            <input type="text" class="form-input" name="sku" value="${item?.sku || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">HSN Code</label>
                            <input type="text" class="form-input" name="hsnCode" value="${item?.hsnCode || ''}" placeholder="e.g. 8471" required>
                        </div>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-input" name="category" required>
                                <option value="Electronics" ${item?.category === 'Electronics' ? 'selected' : ''}>Electronics</option>
                                <option value="Furniture" ${item?.category === 'Furniture' ? 'selected' : ''}>Furniture</option>
                                <option value="Accessories" ${item?.category === 'Accessories' ? 'selected' : ''}>Accessories</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">GST Rate (%)</label>
                            <select class="form-input" name="gstRate" required>
                                <option value="0" ${item?.gstRate === 0 ? 'selected' : ''}>0% (Exempt)</option>
                                <option value="5" ${item?.gstRate === 5 ? 'selected' : ''}>5%</option>
                                <option value="12" ${item?.gstRate === 12 ? 'selected' : ''}>12%</option>
                                <option value="18" ${(item?.gstRate === 18 || !item) ? 'selected' : ''}>18%</option>
                                <option value="28" ${item?.gstRate === 28 ? 'selected' : ''}>28%</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Quantity</label>
                            <input type="number" class="form-input" name="quantity" value="${item?.quantity || 0}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Price (excl. GST)</label>
                            <input type="number" step="0.01" class="form-input" name="price" value="${item?.price || 0}" required>
                        </div>
                    </div>
                    <div class="hint-box" style="margin-bottom: 20px; padding: 12px 16px;">
                        <div style="font-size: 12px; color: var(--text-light);">Price with GST: <strong id="priceWithGst">â‚¹0.00</strong></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Product</button>
                    </div>
                </form>
            `;

            document.getElementById('modal').classList.add('active');

            // Live GST price preview
            const priceInput = document.querySelector('#inventoryForm [name="price"]');
            const gstSelect = document.querySelector('#inventoryForm [name="gstRate"]');
            function updateGstPreview() {
                const price = parseFloat(priceInput.value) || 0;
                const gst = parseInt(gstSelect.value) || 0;
                const withGst = price + (price * gst / 100);
                document.getElementById('priceWithGst').textContent = formatCurrency(withGst);
            }
            priceInput.addEventListener('input', updateGstPreview);
            gstSelect.addEventListener('change', updateGstPreview);
            updateGstPreview();
        }

        function saveInventoryItem(event, itemId) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            data.quantity = parseInt(data.quantity);
            data.price = parseFloat(data.price);
            data.gstRate = parseInt(data.gstRate);
            data.status = data.quantity > 20 ? 'In Stock' : data.quantity > 10 ? 'Low Stock' : 'Critical';

            if (itemId) {
                const index = appData.inventory.findIndex(i => i.id === itemId);
                appData.inventory[index] = { ...appData.inventory[index], ...data };
            } else {
                data.id = appData.inventory.length + 1;
                appData.inventory.push(data);
            }

            saveData('inventory');
            closeModal();
            loadInventory();
        }

        function editInventoryItem(id) {
            openInventoryModal(id);
        }

        function deleteInventoryItem(id) {
            if (confirm('Are you sure you want to delete this item?')) {
                appData.inventory = appData.inventory.filter(i => i.id !== id);
                saveData('inventory');
                document.getElementById('inventoryTable').innerHTML = renderInventoryTable();
            }
        }

        // Sales Page
        function loadSales() {
            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Sales Management</h1>
                    <p class="page-subtitle">Track and manage your sales orders</p>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Sales Orders</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary" onclick="downloadReport('sales', 'csv')">Export</button>
                            <button class="btn btn-primary" onclick="openSalesModal()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                New Sale
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Order Number</th>
                                <th>Customer</th>
                                <th>Date</th>
                                <th>Taxable Amt</th>
                                <th>GST</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="salesTable">
                            ${appData.sales.map(sale => `
                                <tr>
                                    <td style="font-weight: 600;">${sale.orderNumber}</td>
                                    <td>${sale.customer}</td>
                                    <td>${sale.date}</td>
                                    <td>${formatCurrency(sale.taxableAmount || sale.amount)}</td>
                                    <td>
                                        <span style="color: var(--secondary); font-weight: 600; font-size: 12px;">
                                            ${sale.gstRate || 0}%
                                        </span>
                                        <div style="font-size: 11px; color: var(--text-light);">${formatCurrency((sale.cgst || 0) + (sale.sgst || 0))}</div>
                                    </td>
                                    <td style="font-weight: 600;">${formatCurrency(sale.totalWithGst || sale.amount)}</td>
                                    <td>
                                        <span class="status-badge ${sale.status === 'Completed' ? 'success' :
                    sale.status === 'Processing' ? 'pending' : 'pending'
                }">
                                            ${sale.status}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn" title="View GST Details" onclick="viewSaleGst(${sale.id})">
                                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Inventory Filter
        let inventoryFilterActive = false;
        function toggleLowStockFilter(btn) {
            inventoryFilterActive = !inventoryFilterActive;

            if (inventoryFilterActive) {
                btn.style.background = 'var(--secondary)';
                btn.style.color = 'white';
                const lowStock = appData.inventory.filter(i => i.quantity < 20);
                document.getElementById('inventoryTable').innerHTML = renderInventoryTable(lowStock);
                showNotification('Filter Applied', `Showing ${lowStock.length} low stock items`);
            } else {
                btn.style.background = 'var(--bg)';
                btn.style.color = 'var(--text)';
                document.getElementById('inventoryTable').innerHTML = renderInventoryTable();
                showNotification('Filter Cleared', 'Showing all items');
            }
        }

        function openSalesModal() {
            document.getElementById('modalTitle').textContent = 'New Sales Order';
            document.getElementById('modalBody').innerHTML = `
                <form id="salesForm" onsubmit="saveSalesOrder(event)">
                    <div class="form-group">
                        <label class="form-label">Customer Name</label>
                        <input type="text" class="form-input" name="customer" required>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Taxable Amount (excl. GST)</label>
                            <input type="number" step="0.01" class="form-input" name="amount" id="salesAmount" oninput="updateSalesGstPreview()" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">GST Rate (%)</label>
                            <select class="form-input" name="gstRate" id="salesGstRate" onchange="updateSalesGstPreview()" required>
                                <option value="0">0% (Exempt)</option>
                                <option value="5">5%</option>
                                <option value="12">12%</option>
                                <option value="18" selected>18%</option>
                                <option value="28">28%</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">GST Type</label>
                        <select class="form-input" name="gstType" id="salesGstType" onchange="updateSalesGstPreview()">
                            <option value="intra" selected>Intra-State (CGST + SGST)</option>
                            <option value="inter">Inter-State (IGST)</option>
                        </select>
                    </div>
                    <div class="hint-box" style="margin-bottom: 16px; padding: 16px;">
                        <div style="font-size: 13px; font-weight: 600; margin-bottom: 8px; color: var(--secondary);">ðŸ§¾ GST Breakdown</div>
                        <div id="salesGstBreakdown" style="font-size: 13px; display: grid; gap: 4px;"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-input" name="status" required>
                            <option value="Pending">Pending</option>
                            <option value="Processing">Processing</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Order</button>
                    </div>
                </form>
            `;
            document.getElementById('modal').classList.add('active');
            updateSalesGstPreview();
        }

        function updateSalesGstPreview() {
            const amount = parseFloat(document.getElementById('salesAmount')?.value) || 0;
            const rate = parseInt(document.getElementById('salesGstRate')?.value) || 0;
            const type = document.getElementById('salesGstType')?.value || 'intra';
            const gstAmount = amount * rate / 100;
            const total = amount + gstAmount;

            const bd = document.getElementById('salesGstBreakdown');
            if (!bd) return;
            if (type === 'intra') {
                bd.innerHTML = `
                    <div style="display: flex; justify-content: space-between;"><span>Taxable Amount:</span> <strong>${formatCurrency(amount)}</strong></div>
                    <div style="display: flex; justify-content: space-between;"><span>CGST @ ${rate / 2}%:</span> <strong>${formatCurrency(gstAmount / 2)}</strong></div>
                    <div style="display: flex; justify-content: space-between;"><span>SGST @ ${rate / 2}%:</span> <strong>${formatCurrency(gstAmount / 2)}</strong></div>
                    <div style="display: flex; justify-content: space-between; border-top: 1px solid var(--border); padding-top: 4px; margin-top: 4px;"><span style="font-weight: 700;">Total with GST:</span> <strong style="color: var(--secondary);">${formatCurrency(total)}</strong></div>
                `;
            } else {
                bd.innerHTML = `
                    <div style="display: flex; justify-content: space-between;"><span>Taxable Amount:</span> <strong>${formatCurrency(amount)}</strong></div>
                    <div style="display: flex; justify-content: space-between;"><span>IGST @ ${rate}%:</span> <strong>${formatCurrency(gstAmount)}</strong></div>
                    <div style="display: flex; justify-content: space-between; border-top: 1px solid var(--border); padding-top: 4px; margin-top: 4px;"><span style="font-weight: 700;">Total with GST:</span> <strong style="color: var(--secondary);">${formatCurrency(total)}</strong></div>
                `;
            }
        }

        function viewSaleGst(saleId) {
            const sale = appData.sales.find(s => s.id === saleId);
            if (!sale) return;
            const gstType = sale.igst ? 'Inter-State' : 'Intra-State';
            document.getElementById('modalTitle').textContent = `GST Invoice â€” ${sale.orderNumber}`;
            document.getElementById('modalBody').innerHTML = `
                <div style="display: grid; gap: 16px;">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-label">Customer</div><div class="stat-value" style="font-size: 16px;">${sale.customer}</div></div>
                        <div class="stat-card"><div class="stat-label">Date</div><div class="stat-value" style="font-size: 16px;">${sale.date}</div></div>
                        <div class="stat-card"><div class="stat-label">GST Rate</div><div class="stat-value">${sale.gstRate || 0}%</div></div>
                        <div class="stat-card"><div class="stat-label">Type</div><div class="stat-value" style="font-size: 14px;">${gstType}</div></div>
                    </div>
                    <div class="table-container" style="margin: 0;">
                        <table>
                            <tbody>
                                <tr><td style="font-weight: 600;">Taxable Amount</td><td style="text-align: right;">${formatCurrency(sale.taxableAmount || sale.amount)}</td></tr>
                                ${sale.igst ? `
                                    <tr><td>IGST @ ${sale.gstRate}%</td><td style="text-align: right;">${formatCurrency(sale.igst)}</td></tr>
                                ` : `
                                    <tr><td>CGST @ ${(sale.gstRate || 0) / 2}%</td><td style="text-align: right;">${formatCurrency(sale.cgst || 0)}</td></tr>
                                    <tr><td>SGST @ ${(sale.gstRate || 0) / 2}%</td><td style="text-align: right;">${formatCurrency(sale.sgst || 0)}</td></tr>
                                `}
                                <tr style="font-weight: 700; font-size: 16px; border-top: 2px solid var(--border);"><td>Total Amount</td><td style="text-align: right; color: var(--secondary);">${formatCurrency(sale.totalWithGst || sale.amount)}</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function saveSalesOrder(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            const taxableAmount = parseFloat(data.amount);
            const gstRate = parseInt(data.gstRate);
            const gstAmount = taxableAmount * gstRate / 100;
            const totalWithGst = taxableAmount + gstAmount;
            const gstType = data.gstType;

            const newSale = {
                id: appData.sales.length + 1,
                orderNumber: `SO-2024-${String(appData.sales.length + 1).padStart(3, '0')}`,
                customer: data.customer,
                amount: totalWithGst,
                taxableAmount: taxableAmount,
                gstRate: gstRate,
                cgst: gstType === 'intra' ? gstAmount / 2 : 0,
                sgst: gstType === 'intra' ? gstAmount / 2 : 0,
                igst: gstType === 'inter' ? gstAmount : 0,
                totalWithGst: totalWithGst,
                date: new Date().toISOString().split('T')[0],
                status: data.status
            };

            appData.sales.unshift(newSale);
            saveData('sales');
            closeModal();
            loadSales();
        }

        // Purchases Page
        function loadPurchases() {
            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Purchase Orders</h1>
                    <p class="page-subtitle">Manage supplier orders and purchases</p>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Purchase Orders</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" onclick="openPurchaseModal()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                New Purchase Order
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>PO Number</th>
                                <th>Supplier</th>
                                <th>Date</th>
                                <th>Taxable Amt</th>
                                <th>GST</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${appData.purchases.map(po => `
                                <tr>
                                    <td style="font-weight: 600;">${po.poNumber}</td>
                                    <td>${po.supplier}</td>
                                    <td>${po.date}</td>
                                    <td>${formatCurrency(po.taxableAmount || po.amount)}</td>
                                    <td>
                                        <span style="color: var(--secondary); font-weight: 600; font-size: 12px;">
                                            ${po.gstRate || 0}%
                                        </span>
                                        <div style="font-size: 11px; color: var(--text-light);">${formatCurrency((po.cgst || 0) + (po.sgst || 0) + (po.igst || 0))}</div>
                                    </td>
                                    <td style="font-weight: 600;">${formatCurrency(po.totalWithGst || po.amount)}</td>
                                    <td>
                                        <span class="status-badge ${po.status === 'Received' ? 'success' : 'pending'}">
                                            ${po.status}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn" title="View GST Details" onclick="viewPurchaseGst(${po.id})">
                                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function viewPurchaseGst(poId) {
            const po = appData.purchases.find(p => p.id === poId);
            if (!po) return;
            const gstType = po.igst ? 'Inter-State' : 'Intra-State';
            document.getElementById('modalTitle').textContent = `GST Details â€” ${po.poNumber}`;
            document.getElementById('modalBody').innerHTML = `
                <div style="display: grid; gap: 16px;">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-label">Supplier</div><div class="stat-value" style="font-size: 16px;">${po.supplier}</div></div>
                        <div class="stat-card"><div class="stat-label">Date</div><div class="stat-value" style="font-size: 16px;">${po.date}</div></div>
                        <div class="stat-card"><div class="stat-label">GST Rate</div><div class="stat-value">${po.gstRate || 0}%</div></div>
                        <div class="stat-card"><div class="stat-label">Type</div><div class="stat-value" style="font-size: 14px;">${gstType}</div></div>
                    </div>
                    <div class="table-container" style="margin: 0;">
                        <table>
                            <tbody>
                                <tr><td style="font-weight: 600;">Taxable Amount</td><td style="text-align: right;">${formatCurrency(po.taxableAmount || po.amount)}</td></tr>
                                ${po.igst ? `
                                    <tr><td>IGST @ ${po.gstRate}%</td><td style="text-align: right;">${formatCurrency(po.igst)}</td></tr>
                                ` : `
                                    <tr><td>CGST @ ${(po.gstRate || 0) / 2}%</td><td style="text-align: right;">${formatCurrency(po.cgst || 0)}</td></tr>
                                    <tr><td>SGST @ ${(po.gstRate || 0) / 2}%</td><td style="text-align: right;">${formatCurrency(po.sgst || 0)}</td></tr>
                                `}
                                <tr style="font-weight: 700; font-size: 16px; border-top: 2px solid var(--border);"><td>Total Amount</td><td style="text-align: right; color: var(--secondary);">${formatCurrency(po.totalWithGst || po.amount)}</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function openPurchaseModal() {
            document.getElementById('modalTitle').textContent = 'New Purchase Order';
            document.getElementById('modalBody').innerHTML = `
                <form id="purchaseForm" onsubmit="savePurchaseOrder(event)">
                    <div class="form-group">
                        <label class="form-label">Supplier Name</label>
                        <input type="text" class="form-input" name="supplier" required>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Order Amount (excl. GST)</label>
                            <input type="number" step="0.01" class="form-input" name="amount" id="purchaseAmount" oninput="updatePurchaseGstPreview()" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">GST Rate (%)</label>
                            <select class="form-input" name="gstRate" id="purchaseGstRate" onchange="updatePurchaseGstPreview()" required>
                                <option value="0">0% (Exempt)</option>
                                <option value="5">5%</option>
                                <option value="12">12%</option>
                                <option value="18" selected>18%</option>
                                <option value="28">28%</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">GST Type</label>
                        <select class="form-input" name="gstType" id="purchaseGstType" onchange="updatePurchaseGstPreview()">
                            <option value="intra" selected>Intra-State (CGST + SGST)</option>
                            <option value="inter">Inter-State (IGST)</option>
                        </select>
                    </div>
                    <div class="hint-box" style="margin-bottom: 16px; padding: 16px;">
                        <div style="font-size: 13px; font-weight: 600; margin-bottom: 8px; color: var(--secondary);">ðŸ§¾ GST Breakdown</div>
                        <div id="purchaseGstBreakdown" style="font-size: 13px; display: grid; gap: 4px;"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-input" name="status" required>
                            <option value="Pending">Pending</option>
                            <option value="Received">Received</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create PO</button>
                    </div>
                </form>
            `;
            document.getElementById('modal').classList.add('active');
            updatePurchaseGstPreview();
        }

        function updatePurchaseGstPreview() {
            const amount = parseFloat(document.getElementById('purchaseAmount')?.value) || 0;
            const rate = parseInt(document.getElementById('purchaseGstRate')?.value) || 0;
            const type = document.getElementById('purchaseGstType')?.value || 'intra';
            const gstAmount = amount * rate / 100;
            const total = amount + gstAmount;

            const bd = document.getElementById('purchaseGstBreakdown');
            if (!bd) return;
            if (type === 'intra') {
                bd.innerHTML = `
                    <div style="display: flex; justify-content: space-between;"><span>Taxable Amount:</span> <strong>${formatCurrency(amount)}</strong></div>
                    <div style="display: flex; justify-content: space-between;"><span>CGST @ ${rate / 2}%:</span> <strong>${formatCurrency(gstAmount / 2)}</strong></div>
                    <div style="display: flex; justify-content: space-between;"><span>SGST @ ${rate / 2}%:</span> <strong>${formatCurrency(gstAmount / 2)}</strong></div>
                    <div style="display: flex; justify-content: space-between; border-top: 1px solid var(--border); padding-top: 4px; margin-top: 4px;"><span style="font-weight: 700;">Total with GST:</span> <strong style="color: var(--secondary);">${formatCurrency(total)}</strong></div>
                `;
            } else {
                bd.innerHTML = `
                    <div style="display: flex; justify-content: space-between;"><span>Taxable Amount:</span> <strong>${formatCurrency(amount)}</strong></div>
                    <div style="display: flex; justify-content: space-between;"><span>IGST @ ${rate}%:</span> <strong>${formatCurrency(gstAmount)}</strong></div>
                    <div style="display: flex; justify-content: space-between; border-top: 1px solid var(--border); padding-top: 4px; margin-top: 4px;"><span style="font-weight: 700;">Total with GST:</span> <strong style="color: var(--secondary);">${formatCurrency(total)}</strong></div>
                `;
            }
        }

        function savePurchaseOrder(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            const taxableAmount = parseFloat(data.amount);
            const gstRate = parseInt(data.gstRate);
            const gstAmount = taxableAmount * gstRate / 100;
            const totalWithGst = taxableAmount + gstAmount;
            const gstType = data.gstType;

            const newPO = {
                id: appData.purchases.length + 1,
                poNumber: `PO-2024-${String(appData.purchases.length + 1).padStart(3, '0')}`,
                supplier: data.supplier,
                amount: totalWithGst,
                taxableAmount: taxableAmount,
                gstRate: gstRate,
                cgst: gstType === 'intra' ? gstAmount / 2 : 0,
                sgst: gstType === 'intra' ? gstAmount / 2 : 0,
                igst: gstType === 'inter' ? gstAmount : 0,
                totalWithGst: totalWithGst,
                date: new Date().toISOString().split('T')[0],
                status: data.status
            };

            appData.purchases.unshift(newPO);
            saveData('purchases');
            closeModal();
            loadPurchases();
        }

        // HR Page
        function loadHR() {
            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Human Resources</h1>
                    <p class="page-subtitle">Manage employees, payroll, and HR operations</p>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Employees</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" onclick="openEmployeeModal()">
                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                Add Employee
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Department</th>
                                <th>Email</th>
                                <th>Salary</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${appData.employees.map(emp => `
                                <tr>
                                    <td style="font-weight: 600;">${emp.name}</td>
                                    <td>${emp.position}</td>
                                    <td>${emp.department}</td>
                                    <td>${emp.email}</td>
                                    <td>${formatCurrency(emp.salary)}</td>
                                    <td>
                                        <span class="status-badge success">${emp.status}</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn" title="View">
                                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                                </svg>
                                            </button>
                                            <button class="action-btn" title="Edit">
                                                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function openEmployeeModal() {
            document.getElementById('modalTitle').textContent = 'Add New Employee';
            document.getElementById('modalBody').innerHTML = `
                <form id="employeeForm" onsubmit="saveEmployee(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" name="name" required>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Position</label>
                            <input type="text" class="form-input" name="position" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department</label>
                            <select class="form-input" name="department" required>
                                <option value="Sales">Sales</option>
                                <option value="HR">HR</option>
                                <option value="IT">IT</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Finance">Finance</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" name="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Annual Salary</label>
                        <input type="number" class="form-input" name="salary" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Employee</button>
                    </div>
                </form>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function saveEmployee(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            const newEmployee = {
                id: appData.employees.length + 1,
                name: data.name,
                position: data.position,
                department: data.department,
                email: data.email,
                salary: parseInt(data.salary),
                status: 'Active'
            };

            appData.employees.push(newEmployee);
            saveData('employees');
            closeModal();
            loadHR();
        }

        // Finance Page
        function loadFinance() {
            const totalRevenue = appData.sales.reduce((sum, sale) => sum + sale.amount, 0);
            const totalExpenses = appData.purchases.reduce((sum, po) => sum + po.amount, 0);
            const netProfit = totalRevenue - totalExpenses;

            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Finance & Accounting</h1>
                    <p class="page-subtitle">Financial overview and accounting management</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">ðŸ’µ</div>
                        </div>
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value">${formatCurrency(totalRevenue)}</div>
                        <div class="stat-change positive">
                            <span>â†‘</span> From sales orders
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon red">ðŸ’¸</div>
                        </div>
                        <div class="stat-label">Total Expenses</div>
                        <div class="stat-value">${formatCurrency(totalExpenses)}</div>
                        <div class="stat-change negative">
                            <span>â†‘</span> From purchase orders
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon ${netProfit > 0 ? 'green' : 'red'}">ðŸ“Š</div>
                        </div>
                        <div class="stat-label">Net Profit</div>
                        <div class="stat-value">${formatCurrency(netProfit)}</div>
                        <div class="stat-change ${netProfit > 0 ? 'positive' : 'negative'}">
                            <span>${netProfit > 0 ? 'â†‘' : 'â†“'}</span> ${((netProfit / totalRevenue) * 100).toFixed(1)}% margin
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">ðŸ‘¥</div>
                        </div>
                        <div class="stat-label">Payroll</div>
                        <div class="stat-value">${formatCurrency(appData.employees.reduce((sum, emp) => sum + emp.salary, 0))}</div>
                        <div class="stat-change">
                            <span>â†’</span> Annual payroll
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Revenue vs Expenses</h3>
                        <p class="chart-subtitle">Financial comparison for the current period</p>
                    </div>
                    <div class="chart">
                        <div style="flex: 1;">
                            <div class="chart-bar" style="height: ${(totalRevenue / Math.max(totalRevenue, totalExpenses)) * 100}%;"></div>
                            <div class="chart-label">Revenue<br>â‚¹${(totalRevenue / 100000).toFixed(1)}L</div>
                        </div>
                        <div style="flex: 1;">
                            <div class="chart-bar" style="height: ${(totalExpenses / Math.max(totalRevenue, totalExpenses)) * 100}%; background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);"></div>
                            <div class="chart-label">Expenses<br>â‚¹${(totalExpenses / 100000).toFixed(1)}L</div>
                        </div>
                        <div style="flex: 1;">
                            <div class="chart-bar" style="height: ${(netProfit / Math.max(totalRevenue, totalExpenses)) * 100}%; background: linear-gradient(135deg, #10b981 0%, #059669 100%);"></div>
                            <div class="chart-label">Net Profit<br>â‚¹${(netProfit / 100000).toFixed(1)}L</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Analytics Dashboard
        function loadAnalytics() {
            const totalRevenue = appData.sales.reduce((sum, sale) => sum + sale.amount, 0);
            const totalExpenses = appData.purchases.reduce((sum, po) => sum + po.amount, 0);
            const netProfit = totalRevenue - totalExpenses;
            const profitMargin = ((netProfit / totalRevenue) * 100).toFixed(1);
            const inventoryValue = appData.inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            const avgOrderValue = totalRevenue / appData.sales.length;

            // Calculate monthly trends (simulated data based on current totals)
            const monthlyData = generateMonthlyTrends(totalRevenue, totalExpenses);

            // Category breakdown
            const categoryData = calculateCategoryBreakdown();

            // Sales by status
            const statusData = calculateStatusBreakdown();

            // Top customers
            const topCustomers = calculateTopCustomers();

            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Analytics Dashboard</h1>
                    <p class="page-subtitle">Comprehensive business intelligence and data visualization</p>
                </div>

                <div class="tutorial-banner">
                    <div class="tutorial-content">
                        <div class="tutorial-title">ðŸ“Š Interactive Analytics</div>
                        <div class="tutorial-desc">Explore your business data through charts, graphs, and visual insights. Hover over elements for detailed information.</div>
                    </div>
                    <div class="tutorial-actions">
                        <button class="tutorial-btn" onclick="downloadAnalytics()">Export Dashboard</button>
                    </div>
                </div>

                <!-- Key Metrics Overview -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">ðŸ’°</div>
                        </div>
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value">${formatCurrency(totalRevenue)}</div>
                        <div class="mini-chart">
                            ${monthlyData.map(m => `<div class="mini-bar" style="height: ${(m.revenue / Math.max(...monthlyData.map(x => x.revenue))) * 100}%;" title="${m.month}: â‚¹${(m.revenue / 100000).toFixed(1)}L"></div>`).join('')}
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">ðŸ“ˆ</div>
                        </div>
                        <div class="stat-label">Profit Margin</div>
                        <div class="stat-value">${profitMargin}%</div>
                        <div class="trend-indicator trend-up">
                            â†‘ Healthy margin
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">ðŸ“¦</div>
                        </div>
                        <div class="stat-label">Inventory Value</div>
                        <div class="stat-value">${formatCurrency(inventoryValue)}</div>
                        <div class="mini-chart">
                            ${appData.inventory.slice(0, 8).map(item => `<div class="mini-bar" style="height: ${(item.quantity / Math.max(...appData.inventory.map(x => x.quantity))) * 100}%;"></div>`).join('')}
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">ðŸŽ¯</div>
                        </div>
                        <div class="stat-label">Avg Order Value</div>
                        <div class="stat-value">${formatCurrency(avgOrderValue)}</div>
                        <div class="trend-indicator trend-up">
                            â†‘ Strong performance
                        </div>
                    </div>
                </div>

                <!-- Main Charts Grid -->
                <div class="analytics-grid">
                    <!-- Revenue Trend Chart -->
                    <div class="chart-card" style="grid-column: span 2;">
                        <div class="chart-card-header">
                            <div>
                                <div class="chart-card-title">Revenue & Expenses Trend</div>
                                <div class="chart-card-subtitle">Monthly comparison over 6 months</div>
                            </div>
                        </div>
                        <div class="chart">
                            ${monthlyData.map((m, i) => `
                                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                                    <div style="display: flex; gap: 4px; width: 100%; height: 250px; align-items: flex-end; justify-content: center;">
                                        <div class="chart-bar" style="height: ${(m.revenue / Math.max(...monthlyData.map(x => Math.max(x.revenue, x.expenses)))) * 100}%; width: 40%; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);" title="Revenue: â‚¹${(m.revenue / 100000).toFixed(1)}L"></div>
                                        <div class="chart-bar" style="height: ${(m.expenses / Math.max(...monthlyData.map(x => Math.max(x.revenue, x.expenses)))) * 100}%; width: 40%; background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);" title="Expenses: â‚¹${(m.expenses / 100000).toFixed(1)}L"></div>
                                    </div>
                                    <div class="chart-label">${m.month}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color" style="background: #3B82F6;"></div>
                                <span>Revenue</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #EF4444;"></div>
                                <span>Expenses</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sales by Status Pie Chart -->
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div>
                                <div class="chart-card-title">Sales by Status</div>
                                <div class="chart-card-subtitle">Order distribution</div>
                            </div>
                        </div>
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 64px; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                ${appData.sales.length}
                            </div>
                            <div style="font-size: 14px; color: var(--text-light); margin-bottom: 24px;">Total Orders</div>
                            <div style="display: grid; gap: 12px;">
                                ${statusData.map(s => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg); border-radius: 8px;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 12px; height: 12px; border-radius: 3px; background: ${s.color};"></div>
                                            <span style="font-weight: 600;">${s.status}</span>
                                        </div>
                                        <span style="font-weight: 700; color: ${s.color};">${s.count}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Category Performance -->
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div>
                                <div class="chart-card-title">Inventory by Category</div>
                                <div class="chart-card-subtitle">Product distribution</div>
                            </div>
                        </div>
                        <div class="bar-chart-horizontal">
                            ${categoryData.map(cat => `
                                <div class="bar-row">
                                    <div class="bar-label">${cat.name}</div>
                                    <div class="bar-track">
                                        <div class="bar-fill" style="width: ${(cat.count / Math.max(...categoryData.map(c => c.count))) * 100}%;">
                                            <span class="bar-value">${cat.count}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Top Customers -->
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div>
                                <div class="chart-card-title">Top Customers</div>
                                <div class="chart-card-subtitle">By revenue generated</div>
                            </div>
                        </div>
                        <div class="bar-chart-horizontal">
                            ${topCustomers.slice(0, 5).map(customer => `
                                <div class="bar-row">
                                    <div class="bar-label" style="font-size: 12px;">${customer.name}</div>
                                    <div class="bar-track">
                                        <div class="bar-fill" style="width: ${(customer.revenue / Math.max(...topCustomers.map(c => c.revenue))) * 100}%; background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                                            <span class="bar-value">â‚¹${(customer.revenue / 100000).toFixed(1)}L</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Profitability Gauge -->
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div>
                                <div class="chart-card-title">Profit Margin</div>
                                <div class="chart-card-subtitle">Current performance</div>
                            </div>
                        </div>
                        <div style="text-align: center; padding: 30px 20px;">
                            <div style="position: relative; width: 200px; height: 100px; margin: 0 auto 20px;">
                                <div style="width: 200px; height: 200px; border-radius: 50%; background: conic-gradient(
                                    var(--accent) 0deg ${profitMargin * 3.6}deg,
                                    var(--bg) ${profitMargin * 3.6}deg 360deg
                                ); clip-path: polygon(0 0, 100% 0, 100% 50%, 0 50%);"></div>
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                    <div style="font-size: 48px; font-weight: 700;">${profitMargin}%</div>
                                </div>
                            </div>
                            <div class="trend-indicator ${profitMargin > 20 ? 'trend-up' : profitMargin > 10 ? 'trend-neutral' : 'trend-down'}">
                                ${profitMargin > 20 ? 'â†‘ Excellent' : profitMargin > 10 ? 'â†’ Good' : 'â†“ Needs Improvement'}
                            </div>
                        </div>
                    </div>

                    <!-- Financial Comparison -->
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div>
                                <div class="chart-card-title">Revenue vs Expenses</div>
                                <div class="chart-card-subtitle">Total comparison</div>
                            </div>
                        </div>
                        <div class="metric-comparison">
                            <div class="metric-side">
                                <div class="metric-label">Revenue</div>
                                <div class="metric-value" style="color: var(--accent);">â‚¹${(totalRevenue / 100000).toFixed(1)}L</div>
                                <div class="trend-indicator trend-up">+12.5%</div>
                            </div>
                            <div class="metric-divider"></div>
                            <div class="metric-side">
                                <div class="metric-label">Expenses</div>
                                <div class="metric-value" style="color: var(--danger);">â‚¹${(totalExpenses / 100000).toFixed(1)}L</div>
                                <div class="trend-indicator trend-up">+8.3%</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center;">
                            <div class="metric-label">Net Profit</div>
                            <div class="metric-value" style="color: ${netProfit > 0 ? 'var(--accent)' : 'var(--danger)'}; font-size: 32px;">
                                ${formatCurrency(netProfit)}
                            </div>
                        </div>
                    </div>

                    <!-- Business Health Score -->
                    <div class="chart-card">
                        <div class="chart-card-header">
                            <div>
                                <div class="chart-card-title">Business Health Score</div>
                                <div class="chart-card-subtitle">Overall performance rating</div>
                            </div>
                        </div>
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 72px; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                                ${calculateHealthScore(totalRevenue, totalExpenses)}
                            </div>
                            <div style="font-size: 14px; color: var(--text-light); margin-top: 8px;">out of 100</div>
                            <div class="progress-bar" style="margin: 20px 0;">
                                <div class="progress-fill" style="width: ${calculateHealthScore(totalRevenue, totalExpenses)}%;"></div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; text-align: left;">
                                <div style="padding: 12px; background: var(--bg); border-radius: 6px;">
                                    <div style="font-size: 11px; color: var(--text-light); margin-bottom: 4px;">Revenue Growth</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--accent);">85</div>
                                </div>
                                <div style="padding: 12px; background: var(--bg); border-radius: 6px;">
                                    <div style="font-size: 11px; color: var(--text-light); margin-bottom: 4px;">Cash Flow</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--accent);">92</div>
                                </div>
                                <div style="padding: 12px; background: var(--bg); border-radius: 6px;">
                                    <div style="font-size: 11px; color: var(--text-light); margin-bottom: 4px;">Inventory Health</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--warning);">78</div>
                                </div>
                                <div style="padding: 12px; background: var(--bg); border-radius: 6px;">
                                    <div style="font-size: 11px; color: var(--text-light); margin-bottom: 4px;">Efficiency</div>
                                    <div style="font-size: 18px; font-weight: 700; color: var(--accent);">88</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="hint-box" style="margin-top: 24px;">
                    <div class="hint-header">ðŸ’¡ Analytics Insights</div>
                    <div class="hint-content">
                        <strong>Key Findings:</strong>
                        <ul style="margin: 12px 0; padding-left: 20px; line-height: 1.8;">
                            <li>Your profit margin of ${profitMargin}% is ${profitMargin > 20 ? 'excellent' : profitMargin > 10 ? 'healthy' : 'below optimal'}</li>
                            <li>${appData.inventory.filter(i => i.quantity < 20).length} products need restocking to maintain inventory levels</li>
                            <li>Top customer "${topCustomers[0].name}" contributes ${((topCustomers[0].revenue / totalRevenue) * 100).toFixed(1)}% of total revenue</li>
                            <li>Average order value of ${formatCurrency(avgOrderValue)} shows strong customer purchasing power</li>
                        </ul>
                    </div>
                </div>
            `;

            // Unlock achievement
            if (!achievements.financialReport.unlocked) {
                achievements.financialReport.unlocked = true;
                localStorage.setItem('achievements', JSON.stringify(achievements));
                showNotification('Achievement Unlocked! ðŸŽ‰', 'ðŸ“Š Financial Analyst: View analytics dashboard');
            }
        }

        // Helper functions for analytics
        function generateMonthlyTrends(totalRevenue, totalExpenses) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const avgRevenue = totalRevenue / 6;
            const avgExpenses = totalExpenses / 6;
            return months.map((month, index) => ({
                month,
                revenue: avgRevenue * (0.8 + (index * 0.07)) + (Math.random() * avgRevenue * 0.2),
                expenses: avgExpenses * (0.85 + (index * 0.05)) + (Math.random() * avgExpenses * 0.15)
            }));
        }

        function calculateCategoryBreakdown() {
            const categories = {};
            appData.inventory.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + 1;
            });
            return Object.entries(categories).map(([name, count]) => ({ name, count }))
                .sort((a, b) => b.count - a.count);
        }

        function calculateStatusBreakdown() {
            const statuses = {};
            appData.sales.forEach(sale => {
                statuses[sale.status] = (statuses[sale.status] || 0) + 1;
            });
            const colorMap = { 'Completed': '#10B981', 'Pending': '#F59E0B', 'Processing': '#3B82F6' };
            return Object.entries(statuses).map(([status, count]) => ({
                status,
                count,
                color: colorMap[status] || '#64748B'
            }));
        }

        function calculateTopCustomers() {
            const customers = {};
            appData.sales.forEach(sale => {
                if (!customers[sale.customer]) {
                    customers[sale.customer] = { name: sale.customer, revenue: 0, orders: 0 };
                }
                customers[sale.customer].revenue += sale.amount;
                customers[sale.customer].orders++;
            });
            return Object.values(customers).sort((a, b) => b.revenue - a.revenue);
        }

        function calculateHealthScore(totalRevenue, totalExpenses) {
            const profitMargin = ((totalRevenue - totalExpenses) / totalRevenue) * 100;
            const inventoryHealth = (1 - (appData.inventory.filter(i => i.quantity < 20).length / appData.inventory.length)) * 100;
            const salesEfficiency = (appData.sales.filter(s => s.status === 'Completed').length / appData.sales.length) * 100;

            return Math.round((profitMargin * 0.4) + (inventoryHealth * 0.3) + (salesEfficiency * 0.3));
        }

        function downloadAnalytics() {
            const data = {
                generatedAt: new Date().toISOString(),
                summary: {
                    totalRevenue: appData.sales.reduce((sum, sale) => sum + sale.amount, 0),
                    totalExpenses: appData.purchases.reduce((sum, po) => sum + po.amount, 0),
                    netProfit: appData.sales.reduce((sum, sale) => sum + sale.amount, 0) - appData.purchases.reduce((sum, po) => sum + po.amount, 0),
                    healthScore: calculateHealthScore(
                        appData.sales.reduce((sum, sale) => sum + sale.amount, 0),
                        appData.purchases.reduce((sum, po) => sum + po.amount, 0)
                    )
                },
                monthlyTrends: generateMonthlyTrends(
                    appData.sales.reduce((sum, sale) => sum + sale.amount, 0),
                    appData.purchases.reduce((sum, po) => sum + po.amount, 0)
                ),
                topCustomers: calculateTopCustomers(),
                categoryBreakdown: calculateCategoryBreakdown()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analytics_export_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showNotification('Export Complete', 'Analytics data has been exported successfully');
        }

        // Reports Page
        function loadReports() {
            const totalRevenue = appData.sales.reduce((sum, sale) => sum + sale.amount, 0);
            const totalExpenses = appData.purchases.reduce((sum, po) => sum + po.amount, 0);
            const netProfit = totalRevenue - totalExpenses;
            const inventoryValue = appData.inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            const avgSaleValue = totalRevenue / appData.sales.length;

            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Reports & Analytics</h1>
                    <p class="page-subtitle">Generate comprehensive business reports and download them</p>
                </div>

                <div class="tutorial-banner">
                    <div class="tutorial-content">
                        <div class="tutorial-title">ðŸ“Š Generate Reports</div>
                        <div class="tutorial-desc">Click on any report below to generate it and download as CSV, PDF, or view detailed analytics</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">ðŸ“Š</div>
                        </div>
                        <div class="stat-label">Total Reports Available</div>
                        <div class="stat-value">8</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">ðŸ“ˆ</div>
                        </div>
                        <div class="stat-label">Data Points</div>
                        <div class="stat-value">${appData.inventory.length + appData.sales.length + appData.purchases.length + appData.employees.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">ðŸ’¼</div>
                        </div>
                        <div class="stat-label">Net Profit</div>
                        <div class="stat-value">${formatCurrency(netProfit)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">ðŸ“¦</div>
                        </div>
                        <div class="stat-label">Inventory Value</div>
                        <div class="stat-value">${formatCurrency(inventoryValue)}</div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Available Reports</h3>
                    </div>
                    <div style="padding: 24px;">
                        <div style="display: grid; gap: 16px;">
                            <div class="practice-card" onclick="generateReport('sales')">
                                <div class="practice-header">
                                    <div class="practice-title">ðŸ“Š Sales Summary Report</div>
                                    <span class="status-badge success">Ready</span>
                                </div>
                                <div class="practice-desc">Complete sales overview with revenue analysis and customer insights</div>
                                <div class="practice-meta">
                                    <div class="practice-meta-item">${appData.sales.length} sales orders</div>
                                    <div class="practice-meta-item">Revenue: ${formatCurrency(totalRevenue)}</div>
                                </div>
                            </div>

                            <div class="practice-card" onclick="generateReport('inventory')">
                                <div class="practice-header">
                                    <div class="practice-title">ðŸ“¦ Inventory Status Report</div>
                                    <span class="status-badge success">Ready</span>
                                </div>
                                <div class="practice-desc">Current stock levels, product categories, and reorder alerts</div>
                                <div class="practice-meta">
                                    <div class="practice-meta-item">${appData.inventory.length} products</div>
                                    <div class="practice-meta-item">Value: ${formatCurrency(inventoryValue)}</div>
                                </div>
                            </div>

                            <div class="practice-card" onclick="generateReport('financial')">
                                <div class="practice-header">
                                    <div class="practice-title">ðŸ’° Financial Statement</div>
                                    <span class="status-badge success">Ready</span>
                                </div>
                                <div class="practice-desc">Profit & loss statement with revenue, expenses, and margin analysis</div>
                                <div class="practice-meta">
                                    <div class="practice-meta-item">Net Profit: ${formatCurrency(netProfit)}</div>
                                    <div class="practice-meta-item">Margin: ${((netProfit / totalRevenue) * 100).toFixed(1)}%</div>
                                </div>
                            </div>

                            <div class="practice-card" onclick="generateReport('purchases')">
                                <div class="practice-header">
                                    <div class="practice-title">ðŸ›’ Purchase Orders Report</div>
                                    <span class="status-badge success">Ready</span>
                                </div>
                                <div class="practice-desc">Supplier analysis, purchase history, and spending breakdown</div>
                                <div class="practice-meta">
                                    <div class="practice-meta-item">${appData.purchases.length} purchase orders</div>
                                    <div class="practice-meta-item">Total: ${formatCurrency(totalExpenses)}</div>
                                </div>
                            </div>

                            <div class="practice-card" onclick="generateReport('hr')">
                                <div class="practice-header">
                                    <div class="practice-title">ðŸ‘¥ Employee Directory</div>
                                    <span class="status-badge success">Ready</span>
                                </div>
                                <div class="practice-desc">Complete employee list with departments, positions, and salary data</div>
                                <div class="practice-meta">
                                    <div class="practice-meta-item">${appData.employees.length} employees</div>
                                    <div class="practice-meta-item">Total Payroll: ${formatCurrency(appData.employees.reduce((sum, emp) => sum + emp.salary, 0))}</div>
                                </div>
                            </div>

                            <div class="practice-card" onclick="generateReport('performance')">
                                <div class="practice-header">
                                    <div class="practice-title">ðŸ“ˆ Performance Analytics</div>
                                    <span class="status-badge success">Ready</span>
                                </div>
                                <div class="practice-desc">Key performance indicators, trends, and business insights</div>
                                <div class="practice-meta">
                                    <div class="practice-meta-item">Avg Sale: ${formatCurrency(avgSaleValue)}</div>
                                    <div class="practice-meta-item">ROI: ${((netProfit / totalExpenses) * 100).toFixed(1)}%</div>
                                </div>
                            </div>

                            <div class="practice-card" onclick="generateReport('lowstock')">
                                <div class="practice-header">
                                    <div class="practice-title">âš ï¸ Low Stock Alert Report</div>
                                    <span class="status-badge ${appData.inventory.filter(i => i.quantity < 20).length > 0 ? 'pending' : 'success'}">
                                        ${appData.inventory.filter(i => i.quantity < 20).length > 0 ? 'Action Needed' : 'All Good'}
                                    </span>
                                </div>
                                <div class="practice-desc">Items requiring reorder and inventory planning recommendations</div>
                                <div class="practice-meta">
                                    <div class="practice-meta-item">${appData.inventory.filter(i => i.quantity < 20).length} items need attention</div>
                                </div>
                            </div>

                            <div class="practice-card" onclick="generateReport('customer')">
                                <div class="practice-header">
                                    <div class="practice-title">ðŸŽ¯ Customer Analysis</div>
                                    <span class="status-badge success">Ready</span>
                                </div>
                                <div class="practice-desc">Customer purchase patterns, top customers, and revenue by client</div>
                                <div class="practice-meta">
                                    <div class="practice-meta-item">${new Set(appData.sales.map(s => s.customer)).size} unique customers</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Generate and download reports
        function generateReport(reportType) {
            showNotification('Generating Report...', 'Please wait while we prepare your report');

            setTimeout(() => {
                let reportData = '';
                let reportTitle = '';
                let analyticsHTML = '';

                switch (reportType) {
                    case 'sales':
                        reportTitle = 'Sales Summary Report';
                        reportData = generateSalesReport();
                        analyticsHTML = generateSalesAnalytics();
                        break;
                    case 'inventory':
                        reportTitle = 'Inventory Status Report';
                        reportData = generateInventoryReport();
                        analyticsHTML = generateInventoryAnalytics();
                        break;
                    case 'financial':
                        reportTitle = 'Financial Statement';
                        reportData = generateFinancialReport();
                        analyticsHTML = generateFinancialAnalytics();
                        break;
                    case 'purchases':
                        reportTitle = 'Purchase Orders Report';
                        reportData = generatePurchasesReport();
                        analyticsHTML = generatePurchasesAnalytics();
                        break;
                    case 'hr':
                        reportTitle = 'Employee Directory';
                        reportData = generateHRReport();
                        analyticsHTML = generateHRAnalytics();
                        break;
                    case 'performance':
                        reportTitle = 'Performance Analytics Report';
                        reportData = generatePerformanceReport();
                        analyticsHTML = generatePerformanceAnalytics();
                        break;
                    case 'lowstock':
                        reportTitle = 'Low Stock Alert Report';
                        reportData = generateLowStockReport();
                        analyticsHTML = generateLowStockAnalytics();
                        break;
                    case 'customer':
                        reportTitle = 'Customer Analysis Report';
                        reportData = generateCustomerReport();
                        analyticsHTML = generateCustomerAnalytics();
                        break;
                }

                showReportModal(reportTitle, reportData, analyticsHTML, reportType);
            }, 500);
        }

        function showReportModal(title, csvData, analyticsHTML, reportType) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = `
                <div class="tabs" style="margin-bottom: 24px;">
                    <button class="tab active" onclick="switchReportTab('preview')">Preview</button>
                    <button class="tab" onclick="switchReportTab('analytics')">Analytics</button>
                </div>

                <div id="reportPreview">
                    <div style="background: var(--bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; max-height: 400px; overflow-y: auto;">
                        <pre style="white-space: pre-wrap; font-family: 'JetBrains Mono', monospace; font-size: 12px; margin: 0;">${csvData}</pre>
                    </div>

                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="downloadReport('${reportType}', 'csv')">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Download CSV
                        </button>
                        <button class="btn btn-primary" onclick="downloadReport('${reportType}', 'json')">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Download JSON
                        </button>
                        <button class="btn btn-primary" onclick="downloadReport('${reportType}', 'txt')">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            Download TXT
                        </button>
                        <button class="btn btn-secondary" onclick="printReport()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                            </svg>
                            Print
                        </button>
                    </div>
                </div>

                <div id="reportAnalytics" style="display: none;">
                    ${analyticsHTML}
                </div>

                <div class="modal-footer" style="margin-top: 24px;">
                    <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                </div>
            `;
            document.getElementById('modal').classList.add('active');

            // Unlock achievement
            if (!achievements.financialReport.unlocked) {
                achievements.financialReport.unlocked = true;
                localStorage.setItem('achievements', JSON.stringify(achievements));
                showNotification('Achievement Unlocked! ðŸŽ‰', 'ðŸ“Š Financial Analyst: View finance dashboard');
            }
        }

        function switchReportTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'preview') {
                document.getElementById('reportPreview').style.display = 'block';
                document.getElementById('reportAnalytics').style.display = 'none';
            } else {
                document.getElementById('reportPreview').style.display = 'none';
                document.getElementById('reportAnalytics').style.display = 'block';
            }
        }

        // Report Generators
        function generateSalesReport() {
            let csv = 'Order Number,Customer,Date,Amount,Status\n';
            appData.sales.forEach(sale => {
                csv += `${sale.orderNumber},${sale.customer},${sale.date},${sale.amount},${sale.status}\n`;
            });
            csv += `\nTotal Revenue:,,,${appData.sales.reduce((sum, s) => sum + s.amount, 0)},\n`;
            csv += `Average Order Value:,,,${(appData.sales.reduce((sum, s) => sum + s.amount, 0) / appData.sales.length).toFixed(2)},\n`;
            return csv;
        }

        function generateSalesAnalytics() {
            const total = appData.sales.reduce((sum, s) => sum + s.amount, 0);
            const completed = appData.sales.filter(s => s.status === 'Completed').length;
            const pending = appData.sales.filter(s => s.status === 'Pending').length;
            const avgValue = total / appData.sales.length;

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Sales</div>
                        <div class="stat-value">${appData.sales.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value">${formatCurrency(total)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Order Value</div>
                        <div class="stat-value">${formatCurrency(avgValue)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Completion Rate</div>
                        <div class="stat-value">${((completed / appData.sales.length) * 100).toFixed(0)}%</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h4>Sales by Status</h4>
                    <div style="display: flex; gap: 20px; margin-top: 16px;">
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--accent);">${completed}</div>
                            <div style="color: var(--text-light);">Completed</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--warning);">${pending}</div>
                            <div style="color: var(--text-light);">Pending</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 32px; font-weight: 700; color: var(--secondary);">${appData.sales.filter(s => s.status === 'Processing').length}</div>
                            <div style="color: var(--text-light);">Processing</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateInventoryReport() {
            let csv = 'Product Name,SKU,Category,Quantity,Price,Total Value,Status\n';
            appData.inventory.forEach(item => {
                csv += `${item.name},${item.sku},${item.category},${item.quantity},${item.price},${item.quantity * item.price},${item.status}\n`;
            });
            const totalValue = appData.inventory.reduce((sum, i) => sum + (i.quantity * i.price), 0);
            csv += `\nTotal Inventory Value:,,,,,${totalValue},\n`;
            return csv;
        }

        function generateInventoryAnalytics() {
            const totalValue = appData.inventory.reduce((sum, i) => sum + (i.quantity * i.price), 0);
            const totalItems = appData.inventory.reduce((sum, i) => sum + i.quantity, 0);
            const lowStock = appData.inventory.filter(i => i.quantity < 20).length;
            const categories = [...new Set(appData.inventory.map(i => i.category))];

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Products</div>
                        <div class="stat-value">${appData.inventory.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Items</div>
                        <div class="stat-value">${totalItems}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Inventory Value</div>
                        <div class="stat-value">${formatCurrency(totalValue)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Low Stock Items</div>
                        <div class="stat-value" style="color: ${lowStock > 0 ? 'var(--danger)' : 'var(--accent)'};">${lowStock}</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h4>Products by Category</h4>
                    <div style="margin-top: 16px;">
                        ${categories.map(cat => {
                const count = appData.inventory.filter(i => i.category === cat).length;
                return `
                                <div style="margin-bottom: 12px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                        <span style="font-weight: 600;">${cat}</span>
                                        <span>${count} products</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${(count / appData.inventory.length) * 100}%;"></div>
                                    </div>
                                </div>
                            `;
            }).join('')}
                    </div>
                </div>
            `;
        }

        function generateFinancialReport() {
            const revenue = appData.sales.reduce((sum, s) => sum + s.amount, 0);
            const expenses = appData.purchases.reduce((sum, p) => sum + p.amount, 0);
            const payroll = appData.employees.reduce((sum, e) => sum + e.salary, 0);
            const netProfit = revenue - expenses;
            const margin = ((netProfit / revenue) * 100).toFixed(2);

            let csv = 'FINANCIAL STATEMENT\n\n';
            csv += 'REVENUE\n';
            csv += `Total Sales Revenue,${revenue}\n\n`;
            csv += 'EXPENSES\n';
            csv += `Purchase Orders,${expenses}\n`;
            csv += `Annual Payroll,${payroll}\n`;
            csv += `Total Expenses,${expenses}\n\n`;
            csv += 'PROFITABILITY\n';
            csv += `Net Profit,${netProfit}\n`;
            csv += `Profit Margin,${margin}%\n`;
            csv += `ROI,${((netProfit / expenses) * 100).toFixed(2)}%\n`;
            return csv;
        }

        function generateFinancialAnalytics() {
            const revenue = appData.sales.reduce((sum, s) => sum + s.amount, 0);
            const expenses = appData.purchases.reduce((sum, p) => sum + p.amount, 0);
            const netProfit = revenue - expenses;
            const margin = ((netProfit / revenue) * 100).toFixed(1);

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon green">ðŸ’°</div>
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value">${formatCurrency(revenue)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red">ðŸ’¸</div>
                        <div class="stat-label">Total Expenses</div>
                        <div class="stat-value">${formatCurrency(expenses)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon ${netProfit > 0 ? 'green' : 'red'}">ðŸ“Š</div>
                        <div class="stat-label">Net Profit</div>
                        <div class="stat-value">${formatCurrency(netProfit)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon blue">ðŸ“ˆ</div>
                        <div class="stat-label">Profit Margin</div>
                        <div class="stat-value">${margin}%</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h4>Financial Breakdown</h4>
                    <div class="chart" style="height: 200px;">
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                            <div class="chart-bar" style="height: 100%; background: linear-gradient(135deg, #10b981 0%, #059669 100%);"></div>
                            <div class="chart-label">Revenue<br>${formatCurrency(revenue / 1000)}K</div>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                            <div class="chart-bar" style="height: ${(expenses / revenue) * 100}%; background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);"></div>
                            <div class="chart-label">Expenses<br>${formatCurrency(expenses / 1000)}K</div>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                            <div class="chart-bar" style="height: ${(netProfit / revenue) * 100}%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                            <div class="chart-label">Net Profit<br>${formatCurrency(netProfit / 1000)}K</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generatePurchasesReport() {
            let csv = 'PO Number,Supplier,Date,Amount,Status\n';
            appData.purchases.forEach(po => {
                csv += `${po.poNumber},${po.supplier},${po.date},${po.amount},${po.status}\n`;
            });
            csv += `\nTotal Purchases:,,,${appData.purchases.reduce((sum, p) => sum + p.amount, 0)},\n`;
            return csv;
        }

        function generatePurchasesAnalytics() {
            const total = appData.purchases.reduce((sum, p) => sum + p.amount, 0);
            const received = appData.purchases.filter(p => p.status === 'Received').length;
            const pending = appData.purchases.filter(p => p.status === 'Pending').length;

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total POs</div>
                        <div class="stat-value">${appData.purchases.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Spending</div>
                        <div class="stat-value">${formatCurrency(total)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Received</div>
                        <div class="stat-value">${received}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending</div>
                        <div class="stat-value">${pending}</div>
                    </div>
                </div>
            `;
        }

        function generateHRReport() {
            let csv = 'Name,Position,Department,Email,Salary,Status\n';
            appData.employees.forEach(emp => {
                csv += `${emp.name},${emp.position},${emp.department},${emp.email},${emp.salary},${emp.status}\n`;
            });
            csv += `\nTotal Employees:,,,,,${appData.employees.length}\n`;
            csv += `Total Annual Payroll:,,,,,${appData.employees.reduce((sum, e) => sum + e.salary, 0)}\n`;
            return csv;
        }

        function generateHRAnalytics() {
            const totalPayroll = appData.employees.reduce((sum, e) => sum + e.salary, 0);
            const avgSalary = totalPayroll / appData.employees.length;
            const departments = [...new Set(appData.employees.map(e => e.department))];

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Employees</div>
                        <div class="stat-value">${appData.employees.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Payroll</div>
                        <div class="stat-value">${formatCurrency(totalPayroll)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Salary</div>
                        <div class="stat-value">${formatCurrency(avgSalary)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Departments</div>
                        <div class="stat-value">${departments.length}</div>
                    </div>
                </div>
            `;
        }

        function generatePerformanceReport() {
            const revenue = appData.sales.reduce((sum, s) => sum + s.amount, 0);
            const expenses = appData.purchases.reduce((sum, p) => sum + p.amount, 0);
            const roi = ((revenue - expenses) / expenses * 100).toFixed(2);
            const inventoryTurnover = (appData.sales.length / appData.inventory.length).toFixed(2);

            let csv = 'PERFORMANCE ANALYTICS\n\n';
            csv += 'Key Metrics\n';
            csv += `Total Revenue,${revenue}\n`;
            csv += `Total Expenses,${expenses}\n`;
            csv += `ROI,${roi}%\n`;
            csv += `Avg Order Value,${(revenue / appData.sales.length).toFixed(2)}\n`;
            csv += `Inventory Turnover Ratio,${inventoryTurnover}\n`;
            csv += `Sales Conversion Rate,${((appData.sales.filter(s => s.status === 'Completed').length / appData.sales.length) * 100).toFixed(2)}%\n`;
            return csv;
        }

        function generatePerformanceAnalytics() {
            const revenue = appData.sales.reduce((sum, s) => sum + s.amount, 0);
            const expenses = appData.purchases.reduce((sum, p) => sum + p.amount, 0);
            const roi = ((revenue - expenses) / expenses * 100).toFixed(1);

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ROI</div>
                        <div class="stat-value">${roi}%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Conversion Rate</div>
                        <div class="stat-value">${((appData.sales.filter(s => s.status === 'Completed').length / appData.sales.length) * 100).toFixed(0)}%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Order Value</div>
                        <div class="stat-value">${formatCurrency(revenue / appData.sales.length)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Transactions</div>
                        <div class="stat-value">${appData.sales.length + appData.purchases.length}</div>
                    </div>
                </div>
            `;
        }

        function generateLowStockReport() {
            let csv = 'Product Name,SKU,Current Quantity,Status,Reorder Priority\n';
            const lowStock = appData.inventory.filter(i => i.quantity < 20);
            lowStock.forEach(item => {
                const priority = item.quantity < 10 ? 'HIGH' : 'MEDIUM';
                csv += `${item.name},${item.sku},${item.quantity},${item.status},${priority}\n`;
            });
            csv += `\nTotal Items Requiring Attention:,,${lowStock.length},,\n`;
            return csv;
        }

        function generateLowStockAnalytics() {
            const lowStock = appData.inventory.filter(i => i.quantity < 20);
            const critical = appData.inventory.filter(i => i.quantity < 10);

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Low Stock Items</div>
                        <div class="stat-value" style="color: var(--warning);">${lowStock.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Critical Items</div>
                        <div class="stat-value" style="color: var(--danger);">${critical.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Action Required</div>
                        <div class="stat-value">${lowStock.length > 0 ? 'Yes' : 'No'}</div>
                    </div>
                </div>
                ${lowStock.length > 0 ? `
                    <div class="hint-box" style="margin-top: 20px;">
                        <div class="hint-header">âš ï¸ Recommendation</div>
                        <div class="hint-content">
                            ${critical.length > 0 ? `${critical.length} items are critically low and need immediate reordering. ` : ''}
                            Consider placing purchase orders for these items to maintain optimal stock levels.
                        </div>
                    </div>
                ` : ''}
            `;
        }

        function generateCustomerReport() {
            let csv = 'Customer Name,Total Orders,Total Revenue,Avg Order Value,Last Order Date\n';
            const customers = {};
            appData.sales.forEach(sale => {
                if (!customers[sale.customer]) {
                    customers[sale.customer] = { orders: 0, revenue: 0, lastDate: sale.date };
                }
                customers[sale.customer].orders++;
                customers[sale.customer].revenue += sale.amount;
                if (sale.date > customers[sale.customer].lastDate) {
                    customers[sale.customer].lastDate = sale.date;
                }
            });

            Object.entries(customers).forEach(([name, data]) => {
                csv += `${name},${data.orders},${data.revenue},${(data.revenue / data.orders).toFixed(2)},${data.lastDate}\n`;
            });
            return csv;
        }

        function generateCustomerAnalytics() {
            const customers = {};
            appData.sales.forEach(sale => {
                if (!customers[sale.customer]) {
                    customers[sale.customer] = { orders: 0, revenue: 0 };
                }
                customers[sale.customer].orders++;
                customers[sale.customer].revenue += sale.amount;
            });

            const topCustomer = Object.entries(customers).sort((a, b) => b[1].revenue - a[1].revenue)[0];

            return `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Unique Customers</div>
                        <div class="stat-value">${Object.keys(customers).length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Top Customer</div>
                        <div class="stat-value" style="font-size: 16px;">${topCustomer[0]}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Top Customer Revenue</div>
                        <div class="stat-value">${formatCurrency(topCustomer[1].revenue)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Customer Value</div>
                        <div class="stat-value">${formatCurrency(appData.sales.reduce((sum, s) => sum + s.amount, 0) / Object.keys(customers).length)}</div>
                    </div>
                </div>
            `;
        }

        // Download report function
        function downloadReport(reportType, format) {
            let content = '';
            let filename = '';
            let mimeType = '';

            // Generate content based on format
            if (format === 'csv') {
                switch (reportType) {
                    case 'sales': content = generateSalesReport(); break;
                    case 'inventory': content = generateInventoryReport(); break;
                    case 'financial': content = generateFinancialReport(); break;
                    case 'purchases': content = generatePurchasesReport(); break;
                    case 'hr': content = generateHRReport(); break;
                    case 'performance': content = generatePerformanceReport(); break;
                    case 'lowstock': content = generateLowStockReport(); break;
                    case 'customer': content = generateCustomerReport(); break;
                }
                filename = `${reportType}_report_${new Date().toISOString().split('T')[0]}.csv`;
                mimeType = 'text/csv';
            } else if (format === 'json') {
                let data = {};
                switch (reportType) {
                    case 'sales': data = { sales: appData.sales }; break;
                    case 'inventory': data = { inventory: appData.inventory }; break;
                    case 'financial':
                        data = {
                            revenue: appData.sales.reduce((sum, s) => sum + s.amount, 0),
                            expenses: appData.purchases.reduce((sum, p) => sum + p.amount, 0),
                            netProfit: appData.sales.reduce((sum, s) => sum + s.amount, 0) - appData.purchases.reduce((sum, p) => sum + p.amount, 0)
                        };
                        break;
                    case 'purchases': data = { purchases: appData.purchases }; break;
                    case 'hr': data = { employees: appData.employees }; break;
                    case 'performance':
                        data = {
                            totalRevenue: appData.sales.reduce((sum, s) => sum + s.amount, 0),
                            totalExpenses: appData.purchases.reduce((sum, p) => sum + p.amount, 0),
                            totalOrders: appData.sales.length,
                            totalProducts: appData.inventory.length
                        };
                        break;
                    case 'lowstock': data = { lowStockItems: appData.inventory.filter(i => i.quantity < 20) }; break;
                    case 'customer':
                        const customers = {};
                        appData.sales.forEach(sale => {
                            if (!customers[sale.customer]) customers[sale.customer] = { orders: 0, revenue: 0 };
                            customers[sale.customer].orders++;
                            customers[sale.customer].revenue += sale.amount;
                        });
                        data = { customers };
                        break;
                }
                content = JSON.stringify(data, null, 2);
                filename = `${reportType}_report_${new Date().toISOString().split('T')[0]}.json`;
                mimeType = 'application/json';
            } else if (format === 'txt') {
                switch (reportType) {
                    case 'sales': content = generateSalesReport(); break;
                    case 'inventory': content = generateInventoryReport(); break;
                    case 'financial': content = generateFinancialReport(); break;
                    case 'purchases': content = generatePurchasesReport(); break;
                    case 'hr': content = generateHRReport(); break;
                    case 'performance': content = generatePerformanceReport(); break;
                    case 'lowstock': content = generateLowStockReport(); break;
                    case 'customer': content = generateCustomerReport(); break;
                }
                filename = `${reportType}_report_${new Date().toISOString().split('T')[0]}.txt`;
                mimeType = 'text/plain';
            }

            // Create and download file
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showNotification('Download Started', `Your ${format.toUpperCase()} report is downloading...`);
        }

        function printReport() {
            const printContent = document.getElementById('reportPreview').innerHTML;
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Print Report</title>');
            printWindow.document.write('<style>body { font-family: Arial, sans-serif; padding: 20px; } pre { white-space: pre-wrap; }</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(printContent);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }

        // Settings Page
        function loadSettings() {
            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Configure your ERP system preferences</p>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">General Settings</h3>
                    </div>
                    <div style="padding: 24px;">
                        <form onsubmit="saveSettings(event)">
                            <div class="form-group">
                                <label class="form-label">Company Name</label>
                                <input type="text" class="form-input" value="My Company Inc." placeholder="Enter company name">
                            </div>
                            <div class="grid-2">
                                <div class="form-group">
                                    <label class="form-label">Currency</label>
                                    <select class="form-input">
                                        <option selected>INR (â‚¹)</option>
                                        <option>USD ($)</option>
                                        <option>EUR (â‚¬)</option>
                                        <option>GBP (Â£)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Time Zone</label>
                                    <select class="form-input">
                                        <option>UTC-5 (Eastern Time)</option>
                                        <option>UTC-6 (Central Time)</option>
                                        <option>UTC-7 (Mountain Time)</option>
                                        <option>UTC-8 (Pacific Time)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email Notifications</label>
                                <div style="display: flex; gap: 16px; margin-top: 8px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="checkbox" checked>
                                        Low Stock Alerts
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="checkbox" checked>
                                        New Orders
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="checkbox">
                                        Daily Reports
                                    </label>
                                </div>
                            </div>
                            <div style="margin-top: 24px;">
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                                <button type="button" class="btn btn-secondary" style="margin-left: 12px;">Reset Data</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        // Modal Functions
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Click outside modal to close
        document.getElementById('modal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize Dashboard
        loadDashboard();

        // Practice Scenarios and Learning Features
        const practiceScenarios = [
            {
                id: 'inventory-basics',
                title: 'Inventory Management Basics',
                level: 'beginner',
                duration: '15 min',
                tasks: 3,
                description: 'Learn how to add products, manage stock levels, and understand inventory status indicators.'
            },
            {
                id: 'sales-order',
                title: 'Processing Sales Orders',
                level: 'beginner',
                duration: '20 min',
                tasks: 4,
                description: 'Master the complete sales order lifecycle from creation to completion.'
            },
            {
                id: 'purchase-order',
                title: 'Creating Purchase Orders',
                level: 'intermediate',
                duration: '25 min',
                tasks: 3,
                description: 'Learn supplier management and how to create and track purchase orders.'
            },
            {
                id: 'hr-management',
                title: 'Employee Management',
                level: 'intermediate',
                duration: '20 min',
                tasks: 3,
                description: 'Manage your workforce by adding employees and understanding HR operations.'
            },
            {
                id: 'financial-analysis',
                title: 'Financial Analysis & Reporting',
                level: 'advanced',
                duration: '30 min',
                tasks: 4,
                description: 'Analyze business performance through financial reports and metrics.'
            },
            {
                id: 'complete-workflow',
                title: 'End-to-End Business Workflow',
                level: 'advanced',
                duration: '45 min',
                tasks: 6,
                description: 'Complete a full business cycle from receiving inventory to fulfilling sales.'
            }
        ];

        const achievements = JSON.parse(localStorage.getItem('achievements')) || {
            firstProduct: { name: 'First Step', desc: 'Add your first product', unlocked: false, icon: 'ðŸŽ¯' },
            tenProducts: { name: 'Inventory Builder', desc: 'Add 10 products', unlocked: false, icon: 'ðŸ“¦' },
            firstSale: { name: 'First Sale', desc: 'Create your first sale', unlocked: false, icon: 'ðŸ’°' },
            tenSales: { name: 'Sales Pro', desc: 'Complete 10 sales', unlocked: false, icon: 'ðŸš€' },
            firstEmployee: { name: 'Team Builder', desc: 'Add your first employee', unlocked: false, icon: 'ðŸ‘¥' },
            financialReport: { name: 'Financial Analyst', desc: 'View finance dashboard', unlocked: false, icon: 'ðŸ“Š' },
            completeBeginner: { name: 'Graduate', desc: 'Complete all beginner scenarios', unlocked: false, icon: 'ðŸŽ“' },
            completeIntermediate: { name: 'Expert', desc: 'Complete all intermediate scenarios', unlocked: false, icon: 'â­' }
        };

        // Check achievements
        function checkAchievements() {
            let newlyUnlocked = [];

            if (!achievements.firstProduct.unlocked && appData.inventory.length >= 6) {
                achievements.firstProduct.unlocked = true;
                newlyUnlocked.push(achievements.firstProduct);
            }
            if (!achievements.tenProducts.unlocked && appData.inventory.length >= 10) {
                achievements.tenProducts.unlocked = true;
                newlyUnlocked.push(achievements.tenProducts);
            }
            if (!achievements.firstSale.unlocked && appData.sales.length >= 6) {
                achievements.firstSale.unlocked = true;
                newlyUnlocked.push(achievements.firstSale);
            }
            if (!achievements.tenSales.unlocked && appData.sales.length >= 10) {
                achievements.tenSales.unlocked = true;
                newlyUnlocked.push(achievements.tenSales);
            }
            if (!achievements.firstEmployee.unlocked && appData.employees.length >= 5) {
                achievements.firstEmployee.unlocked = true;
                newlyUnlocked.push(achievements.firstEmployee);
            }

            localStorage.setItem('achievements', JSON.stringify(achievements));

            newlyUnlocked.forEach(achievement => {
                showNotification('Achievement Unlocked! ðŸŽ‰', `${achievement.icon} ${achievement.name}: ${achievement.desc}`);
            });
        }

        // Show notification
        function showNotification(title, message) {
            const notification = document.createElement('div');
            notification.className = 'notification-toast';
            notification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-icon">ðŸŽ‰</div>
                    <div class="notification-title">${title}</div>
                </div>
                <div class="notification-message">${message}</div>
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 4000);
        }

        // Practice Mode Page
        function loadPractice() {
            document.getElementById('pageContent').innerHTML = `
                <div class="tutorial-banner">
                    <div class="tutorial-content">
                        <div class="tutorial-title">ðŸŽ“ Practice Mode</div>
                        <div class="tutorial-desc">Complete hands-on scenarios to master ERP operations. Track your progress and unlock achievements!</div>
                    </div>
                    <div class="tutorial-actions">
                        <button class="tutorial-btn" onclick="resetProgress()">Reset Progress</button>
                    </div>
                </div>

                <div class="page-header">
                    <h1 class="page-title">Practice Scenarios</h1>
                    <p class="page-subtitle">Hands-on learning experiences to build your ERP skills</p>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="filterScenarios('all')">All Scenarios</button>
                    <button class="tab" onclick="filterScenarios('beginner')">Beginner</button>
                    <button class="tab" onclick="filterScenarios('intermediate')">Intermediate</button>
                    <button class="tab" onclick="filterScenarios('advanced')">Advanced</button>
                </div>

                <div id="scenariosContainer">
                    ${practiceScenarios.map(scenario => `
                        <div class="practice-card" data-level="${scenario.level}" onclick="startScenario('${scenario.id}')">
                            <div class="practice-header">
                                <div class="practice-title">${scenario.title}</div>
                                <span class="practice-badge ${scenario.level}">${scenario.level}</span>
                            </div>
                            <div class="practice-desc">${scenario.description}</div>
                            <div class="practice-meta">
                                <div class="practice-meta-item">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    ${scenario.duration}
                                </div>
                                <div class="practice-meta-item">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                                    </svg>
                                    ${scenario.tasks} tasks
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function filterScenarios(level) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            const cards = document.querySelectorAll('.practice-card');
            cards.forEach(card => {
                if (level === 'all' || card.dataset.level === level) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function startScenario(scenarioId) {
            const scenario = practiceScenarios.find(s => s.id === scenarioId);
            showNotification('Scenario Started', `Starting: ${scenario.title}`);

            // Navigate to appropriate page based on scenario
            if (scenarioId.includes('inventory')) {
                loadPage('inventory');
            } else if (scenarioId.includes('sales')) {
                loadPage('sales');
            } else if (scenarioId.includes('purchase')) {
                loadPage('purchases');
            } else if (scenarioId.includes('hr')) {
                loadPage('hr');
            } else if (scenarioId.includes('financial')) {
                loadPage('finance');
            }
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress and data?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Learning Path Page
        function loadLearningPath() {
            const pathSteps = [
                { title: 'Introduction to ERP', desc: 'Understanding the basics', page: 'dashboard', completed: true },
                { title: 'Inventory Management', desc: 'Add and manage products', page: 'inventory', completed: true },
                { title: 'Sales Operations', desc: 'Create and process orders', page: 'sales', completed: false },
                { title: 'Purchase Management', desc: 'Work with suppliers', page: 'purchases', completed: false },
                { title: 'Human Resources', desc: 'Manage employees', page: 'hr', completed: false },
                { title: 'Financial Analysis', desc: 'Analyze business metrics', page: 'finance', completed: false }
            ];

            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Learning Path</h1>
                    <p class="page-subtitle">Your structured journey to ERP mastery</p>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" style="width: 33%;"></div>
                </div>
                <div class="progress-text">2 of 6 modules completed (33%)</div>

                <div style="margin-top: 32px;">
                    <div class="learning-path">
                        ${pathSteps.map((step, index) => `
                            <div class="path-item">
                                <div class="path-marker ${step.completed ? 'completed' : (index === 2 ? 'current' : '')}">
                                    ${step.completed ? 'âœ“' : index + 1}
                                </div>
                                <div class="path-content">
                                    <div class="practice-title">${step.title}</div>
                                    <div class="practice-desc">${step.desc}</div>
                                    ${!step.completed ? `<button class="btn btn-primary" style="margin-top: 12px;" onclick="loadPage('${step.page}')">Start Module</button>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Achievements Page
        function loadAchievements() {
            const achievementsList = Object.values(achievements);
            const unlockedCount = achievementsList.filter(a => a.unlocked).length;

            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Achievements</h1>
                    <p class="page-subtitle">Unlock achievements as you master the ERP system</p>
                </div>

                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="stat-card">
                        <div class="stat-label">Total Achievements</div>
                        <div class="stat-value">${achievementsList.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Unlocked</div>
                        <div class="stat-value">${unlockedCount}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Progress</div>
                        <div class="stat-value">${Math.round((unlockedCount / achievementsList.length) * 100)}%</div>
                    </div>
                </div>

                <div class="progress-bar" style="margin: 24px 0;">
                    <div class="progress-fill" style="width: ${(unlockedCount / achievementsList.length) * 100}%;"></div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 32px;">
                    ${achievementsList.map(achievement => `
                        <div class="achievement-card ${achievement.unlocked ? 'unlocked' : 'locked'}">
                            <div class="achievement-icon">${achievement.icon}</div>
                            <div class="achievement-name">${achievement.name}</div>
                            <div class="achievement-desc">${achievement.desc}</div>
                            ${achievement.unlocked ? '<div style="color: var(--accent); font-weight: 600; margin-top: 8px; font-size: 12px;">âœ“ UNLOCKED</div>' : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Knowledge Base Page
        // Knowledge Base Data
        const kbArticles = [
            {
                id: 'kb-1',
                icon: 'ðŸ¢',
                iconBg: 'linear-gradient(135deg, #6366f1, #818cf8)',
                title: 'What is ERP? â€” A Complete Overview',
                category: 'ERP Basics',
                difficulty: 'beginner',
                readTime: 5,
                summary: 'Understand Enterprise Resource Planning systems â€” what they do, why they matter, and how they transform businesses.',
                content: `
                    <h4>Definition</h4>
                    <p>ERP (Enterprise Resource Planning) is a type of software that integrates all core business processes â€” inventory, sales, purchasing, finance, and HR â€” into one unified platform for better decision-making and operational efficiency.</p>
                    <h4>Core Modules of an ERP</h4>
                    <ul>
                        <li><strong>Inventory Management</strong> â€” Track stock levels, SKUs, warehouse locations</li>
                        <li><strong>Sales & CRM</strong> â€” Manage orders, customers, and revenue pipelines</li>
                        <li><strong>Purchase Management</strong> â€” Handle supplier relationships and procurement</li>
                        <li><strong>Finance & Accounting</strong> â€” General ledger, tax compliance (GST), reporting</li>
                        <li><strong>Human Resources</strong> â€” Employee records, payroll, leave management</li>
                    </ul>
                    <div class="kb-tip-box">ðŸ’¡ <strong>Pro Tip:</strong> Start by mastering one module at a time. Most businesses begin with Inventory and Sales before expanding to Finance and HR.</div>
                    <h4>Benefits</h4>
                    <ul>
                        <li>Eliminates data silos â€” single source of truth</li>
                        <li>Automates repetitive tasks and reduces manual errors</li>
                        <li>Provides real-time dashboards and analytics</li>
                        <li>Improves compliance with regulatory requirements (e.g., GST)</li>
                    </ul>
                `,
                related: ['kb-2', 'kb-12']
            },
            {
                id: 'kb-2',
                icon: 'ðŸš€',
                iconBg: 'linear-gradient(135deg, #10b981, #34d399)',
                title: 'Getting Started â€” Your First Day with ERP',
                category: 'ERP Basics',
                difficulty: 'beginner',
                readTime: 4,
                summary: 'A step-by-step onboarding guide to set up your ERP system and start managing operations immediately.',
                content: `
                    <h4>Step 1: Familiarize Yourself with the Dashboard</h4>
                    <p>The Dashboard is your home screen. It provides a quick snapshot of total revenue, inventory value, low stock alerts, and active employees. Use it every morning to plan your day.</p>
                    <h4>Step 2: Set Up Your Inventory</h4>
                    <p>Navigate to <strong>Inventory</strong> and add your products. Each product needs a name, SKU, HSN code, category, quantity, price, and GST rate.</p>
                    <h4>Step 3: Create Your First Sales Order</h4>
                    <p>Go to <strong>Sales</strong> â†’ click <strong>New Sale</strong>. Enter the customer name, taxable amount, select the GST rate and type, then create the order.</p>
                    <div class="kb-warning-box">âš ï¸ <strong>Important:</strong> Make sure you select the correct GST Type (Intra-State vs Inter-State) â€” this determines whether CGST+SGST or IGST applies.</div>
                    <h4>Step 4: Explore Reports</h4>
                    <p>Visit the <strong>Reports</strong> section to generate sales, inventory, and financial reports. You can export them as CSV, JSON, or print directly.</p>
                `,
                related: ['kb-1', 'kb-3']
            },
            {
                id: 'kb-3',
                icon: 'ðŸ“¦',
                iconBg: 'linear-gradient(135deg, #f59e0b, #fbbf24)',
                title: 'Inventory Management â€” Stock Control Mastery',
                category: 'Inventory',
                difficulty: 'intermediate',
                readTime: 6,
                summary: 'Learn to manage stock levels, HSN codes, reorder points, and prevent stockouts or overstocking.',
                content: `
                    <h4>Understanding Stock Status</h4>
                    <ul>
                        <li><strong>In Stock (>20 units)</strong> â€” Healthy level, no action needed</li>
                        <li><strong>Low Stock (11-20 units)</strong> â€” Consider reordering soon</li>
                        <li><strong>Critical (â‰¤10 units)</strong> â€” Immediate reorder required</li>
                    </ul>
                    <h4>HSN Codes</h4>
                    <p>The Harmonized System of Nomenclature (HSN) code is a globally standardized numerical code for classifying goods. In India, HSN codes are required for GST filing.</p>
                    <ul>
                        <li>Electronics (Laptops, Monitors): <code>8471</code>, <code>8528</code></li>
                        <li>Furniture (Chairs, Desks): <code>9401</code>, <code>9403</code></li>
                        <li>Accessories (Mice, USB Hubs): <code>8471</code>, <code>8473</code></li>
                    </ul>
                    <div class="kb-tip-box">ðŸ’¡ <strong>Pro Tip:</strong> Use the "Filter Low Stock" button in Inventory to quickly identify products that need reordering.</div>
                    <h4>Best Practices</h4>
                    <ul>
                        <li>Conduct periodic stock audits to match physical and system counts</li>
                        <li>Set minimum order quantities for each product</li>
                        <li>Group products by category for faster lookup</li>
                    </ul>
                `,
                related: ['kb-4', 'kb-6']
            },
            {
                id: 'kb-4',
                icon: 'ðŸ›’',
                iconBg: 'linear-gradient(135deg, #3b82f6, #60a5fa)',
                title: 'Sales Orders â€” From Quote to Cash',
                category: 'Sales & CRM',
                difficulty: 'intermediate',
                readTime: 5,
                summary: 'Master the full sales cycle â€” creating orders, tracking status, managing GST compliance, and exporting reports.',
                content: `
                    <h4>Sales Order Workflow</h4>
                    <ul>
                        <li><strong>Pending</strong> â€” Order created, awaiting processing</li>
                        <li><strong>Processing</strong> â€” Order is being fulfilled</li>
                        <li><strong>Completed</strong> â€” Order delivered and payment received</li>
                    </ul>
                    <h4>GST on Sales</h4>
                    <p>When creating a sales order, the system automatically computes:</p>
                    <ul>
                        <li><strong>Intra-State:</strong> CGST (half rate) + SGST (half rate)</li>
                        <li><strong>Inter-State:</strong> IGST (full rate)</li>
                    </ul>
                    <p>Click the ðŸ‘ eye icon on any order to view the full GST invoice breakdown.</p>
                    <div class="kb-tip-box">ðŸ’¡ <strong>Pro Tip:</strong> Use the "Export" button to download all sales data as a CSV for accounting software like Tally or Zoho Books.</div>
                    <h4>Key Metrics to Track</h4>
                    <ul>
                        <li>Average Order Value (AOV)</li>
                        <li>Order-to-cash cycle time</li>
                        <li>Monthly/quarterly revenue trends</li>
                    </ul>
                `,
                related: ['kb-5', 'kb-6']
            },
            {
                id: 'kb-5',
                icon: 'ðŸ§¾',
                iconBg: 'linear-gradient(135deg, #8b5cf6, #a78bfa)',
                title: 'Purchase Orders â€” Supplier Management',
                category: 'Sales & CRM',
                difficulty: 'intermediate',
                readTime: 4,
                summary: 'Streamline procurement by managing supplier orders, tracking delivery status, and handling input GST credits.',
                content: `
                    <h4>Creating Purchase Orders</h4>
                    <p>Navigate to <strong>Purchases</strong> â†’ <strong>New Purchase Order</strong>. Enter the supplier name, taxable amount (excl. GST), select GST rate and type.</p>
                    <h4>Purchase Status Flow</h4>
                    <ul>
                        <li><strong>Pending</strong> â€” PO raised, awaiting supplier confirmation</li>
                        <li><strong>Received</strong> â€” Goods delivered and inventory updated</li>
                    </ul>
                    <h4>Input Tax Credit (ITC)</h4>
                    <p>GST paid on purchases can be claimed as Input Tax Credit against GST collected on sales. This reduces your overall tax liability.</p>
                    <div class="kb-warning-box">âš ï¸ <strong>Important:</strong> Ensure your supplier's GSTIN is valid and the invoice details match to claim ITC successfully.</div>
                `,
                related: ['kb-4', 'kb-6']
            },
            {
                id: 'kb-6',
                icon: 'ðŸ’°',
                iconBg: 'linear-gradient(135deg, #ef4444, #f87171)',
                title: 'GST Compliance â€” Rates, HSN & Filing',
                category: 'Finance & GST',
                difficulty: 'advanced',
                readTime: 8,
                summary: 'A comprehensive guide to India\'s GST system â€” understanding rate slabs, HSN codes, CGST/SGST/IGST, and ITC.',
                content: `
                    <h4>GST Rate Structure</h4>
                    <ul>
                        <li><strong>0% (Exempt)</strong> â€” Essential goods: fresh food, healthcare, education</li>
                        <li><strong>5%</strong> â€” Mass consumption items: packaged food, footwear under â‚¹500</li>
                        <li><strong>12%</strong> â€” Processed foods, business class air tickets, apparel â‚¹1000+</li>
                        <li><strong>18%</strong> â€” Most goods and services: electronics, IT services, restaurants</li>
                        <li><strong>28%</strong> â€” Luxury items: cars, tobacco, aerated beverages</li>
                    </ul>
                    <h4>Types of GST</h4>
                    <ul>
                        <li><strong>CGST (Central)</strong> â€” Goes to the Central Government</li>
                        <li><strong>SGST (State)</strong> â€” Goes to the State Government</li>
                        <li><strong>IGST (Integrated)</strong> â€” For inter-state transactions, goes to Central then settled</li>
                    </ul>
                    <div class="kb-tip-box">ðŸ’¡ <strong>Example:</strong> A â‚¹10,000 sale at 18% GST in intra-state produces CGST â‚¹900 + SGST â‚¹900 = Total â‚¹11,800. The same sale inter-state would be IGST â‚¹1,800 = Total â‚¹11,800.</div>
                    <h4>HSN Code Requirement</h4>
                    <ul>
                        <li>Turnover up to â‚¹1.5 Cr â€” HSN codes optional</li>
                        <li>â‚¹1.5 Cr to â‚¹5 Cr â€” 2-digit HSN mandatory</li>
                        <li>Above â‚¹5 Cr â€” 4-digit HSN mandatory</li>
                    </ul>
                `,
                related: ['kb-3', 'kb-7']
            },
            {
                id: 'kb-7',
                icon: 'ðŸ“Š',
                iconBg: 'linear-gradient(135deg, #14b8a6, #5eead4)',
                title: 'Financial Reports & Business Health',
                category: 'Finance & GST',
                difficulty: 'intermediate',
                readTime: 5,
                summary: 'Learn to read financial reports, understand key financial metrics, and assess your business health score.',
                content: `
                    <h4>Available Reports</h4>
                    <ul>
                        <li><strong>Sales Report</strong> â€” Revenue breakdown by customer and status</li>
                        <li><strong>Inventory Report</strong> â€” Stock levels, valuation, and categories</li>
                        <li><strong>Financial Report</strong> â€” Profit/loss, margins, cash flow overview</li>
                        <li><strong>Purchase Report</strong> â€” Supplier-wise spending analysis</li>
                        <li><strong>HR Report</strong> â€” Payroll costs and headcount</li>
                    </ul>
                    <h4>Reading the Analytics Dashboard</h4>
                    <p>The Analytics Dashboard scores your business health on a 0-100 scale. It evaluates:</p>
                    <ul>
                        <li>Revenue vs expenses ratio</li>
                        <li>Inventory turnover rate</li>
                        <li>Order fulfillment efficiency</li>
                        <li>Employee productivity</li>
                    </ul>
                    <div class="kb-tip-box">ðŸ’¡ <strong>Pro Tip:</strong> Export reports in CSV format for further analysis in Excel or Google Sheets. Use JSON format for integration with other systems.</div>
                `,
                related: ['kb-6', 'kb-11']
            },
            {
                id: 'kb-8',
                icon: 'ðŸ‘¥',
                iconBg: 'linear-gradient(135deg, #ec4899, #f472b6)',
                title: 'Human Resources â€” Employee Management',
                category: 'HR & Payroll',
                difficulty: 'beginner',
                readTime: 4,
                summary: 'Manage employee records, departments, salaries, and track workforce performance metrics.',
                content: `
                    <h4>Employee Records</h4>
                    <p>Each employee profile tracks: name, position, department, salary, joining date, and employment status.</p>
                    <h4>Departments</h4>
                    <ul>
                        <li><strong>Engineering</strong> â€” Product development, technology</li>
                        <li><strong>Sales</strong> â€” Revenue generation, customer relationships</li>
                        <li><strong>Marketing</strong> â€” Brand awareness, lead generation</li>
                        <li><strong>HR</strong> â€” People operations, recruitment</li>
                    </ul>
                    <h4>Payroll Considerations</h4>
                    <p>Monthly payroll costs should be tracked as a key operating expense. Monitor the salary-to-revenue ratio to ensure sustainability.</p>
                    <div class="kb-warning-box">âš ï¸ <strong>Compliance Note:</strong> Ensure all employee records comply with labor law requirements. Maintain proper documentation for audits.</div>
                `,
                related: ['kb-9', 'kb-7']
            },
            {
                id: 'kb-9',
                icon: 'ðŸŽ¯',
                iconBg: 'linear-gradient(135deg, #f97316, #fb923c)',
                title: 'Performance Tracking & KPIs',
                category: 'HR & Payroll',
                difficulty: 'advanced',
                readTime: 6,
                summary: 'Define and measure Key Performance Indicators across all departments for data-driven management.',
                content: `
                    <h4>What are KPIs?</h4>
                    <p>Key Performance Indicators are quantifiable measures that evaluate the success of an organization or specific activities. Good KPIs are SMART: Specific, Measurable, Achievable, Relevant, and Time-bound.</p>
                    <h4>Essential ERP KPIs</h4>
                    <ul>
                        <li><strong>Inventory Turnover</strong> â€” How quickly stock is sold and replaced</li>
                        <li><strong>Days Sales Outstanding (DSO)</strong> â€” Average time to collect revenue</li>
                        <li><strong>Gross Margin %</strong> â€” Profitability per unit sold</li>
                        <li><strong>Order Fulfillment Rate</strong> â€” % of orders delivered on time</li>
                        <li><strong>Employee Productivity</strong> â€” Revenue per employee</li>
                    </ul>
                    <div class="kb-tip-box">ðŸ’¡ <strong>Pro Tip:</strong> Focus on 3-5 KPIs maximum per department. Too many metrics lead to analysis paralysis.</div>
                    <h4>Setting Targets</h4>
                    <p>Use the Analytics Dashboard to track these KPIs over time. Set monthly or quarterly targets and review progress in team meetings.</p>
                `,
                related: ['kb-8', 'kb-11']
            },
            {
                id: 'kb-10',
                icon: 'ðŸ”’',
                iconBg: 'linear-gradient(135deg, #64748b, #94a3b8)',
                title: 'Data Security & Best Practices',
                category: 'ERP Basics',
                difficulty: 'beginner',
                readTime: 3,
                summary: 'Essential security practices to protect your business data â€” backups, access control, and data hygiene.',
                content: `
                    <h4>Data Backup</h4>
                    <p>This ERP system stores data in your browser's localStorage. While convenient, this means data is tied to your browser and device.</p>
                    <div class="kb-warning-box">âš ï¸ <strong>Critical:</strong> Regularly export your data using the Reports â†’ Export feature. Clearing browser data will delete all ERP records.</div>
                    <h4>Best Practices</h4>
                    <ul>
                        <li>Export CSV backups weekly and store them securely</li>
                        <li>Don't share your browser session with unauthorized users</li>
                        <li>Regularly verify that your data is accurate</li>
                        <li>Use the Settings page to configure alerts and notifications</li>
                    </ul>
                    <h4>Data Accuracy</h4>
                    <p>Clean data is the foundation of good decisions. Periodically audit your inventory counts, customer records, and financial entries.</p>
                `,
                related: ['kb-1', 'kb-12']
            },
            {
                id: 'kb-11',
                icon: 'ðŸ“ˆ',
                iconBg: 'linear-gradient(135deg, #0ea5e9, #38bdf8)',
                title: 'Analytics Dashboard â€” Data-Driven Decisions',
                category: 'Analytics',
                difficulty: 'intermediate',
                readTime: 5,
                summary: 'Leverage the Analytics Dashboard to understand business trends, compare performance, and make informed decisions.',
                content: `
                    <h4>Dashboard Components</h4>
                    <ul>
                        <li><strong>Business Health Score</strong> â€” Overall performance metric (0-100)</li>
                        <li><strong>Revenue Trends</strong> â€” Monthly sales and purchase comparisons</li>
                        <li><strong>Category Breakdown</strong> â€” Inventory distribution by product category</li>
                        <li><strong>Top Performers</strong> â€” Identify best-selling products and top customers</li>
                    </ul>
                    <h4>How to Use Analytics</h4>
                    <p>Visit the Analytics Dashboard weekly to review trends. Look for patterns like seasonal demand changes, slowing inventory turnover, or rising costs.</p>
                    <div class="kb-tip-box">ðŸ’¡ <strong>Pro Tip:</strong> Compare the "Revenue vs Expenses" chart month-over-month. A widening gap in favor of revenue indicates healthy growth.</div>
                    <h4>Actionable Insights</h4>
                    <ul>
                        <li>If inventory turnover is low â†’ reduce stock levels or run promotions</li>
                        <li>If gross margin is shrinking â†’ review pricing or negotiate with suppliers</li>
                        <li>If a category dominates â†’ consider expanding that product line</li>
                    </ul>
                `,
                related: ['kb-7', 'kb-9']
            },
            {
                id: 'kb-12',
                icon: 'âš™ï¸',
                iconBg: 'linear-gradient(135deg, #a855f7, #c084fc)',
                title: 'Settings & Customization',
                category: 'ERP Basics',
                difficulty: 'beginner',
                readTime: 3,
                summary: 'Configure your ERP system â€” company details, notification preferences, currency format, and user profile.',
                content: `
                    <h4>Company Settings</h4>
                    <p>Navigate to <strong>Settings</strong> to configure your company name, tax ID, business address, and contact details. This information appears on reports and invoices.</p>
                    <h4>Notification Preferences</h4>
                    <ul>
                        <li><strong>Low Stock Alerts</strong> â€” Get notified when products drop below threshold</li>
                        <li><strong>Order Updates</strong> â€” Status change notifications for sales and purchases</li>
                        <li><strong>System Alerts</strong> â€” Important system-level notifications</li>
                    </ul>
                    <h4>User Profile</h4>
                    <p>Click your avatar in the top-right corner to access your profile. You can update your name, email, and other details.</p>
                    <div class="kb-tip-box">ðŸ’¡ <strong>Pro Tip:</strong> Enable all notification types during setup so you never miss critical alerts like low stock or overdue orders.</div>
                `,
                related: ['kb-1', 'kb-10']
            }
        ];

        const kbCategories = ['All', 'ERP Basics', 'Inventory', 'Sales & CRM', 'Finance & GST', 'HR & Payroll', 'Analytics'];

        let kbBookmarks = JSON.parse(localStorage.getItem('erpKBBookmarks') || '[]');
        let kbActiveCategory = 'All';
        let kbSearchQuery = '';
        let kbExpandedArticle = null;

        function loadKnowledgeBase() {
            const bookmarkCount = kbBookmarks.length;
            const categoryCountMap = {};
            kbCategories.forEach(c => { if (c !== 'All') categoryCountMap[c] = kbArticles.filter(a => a.category === c).length; });

            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Knowledge Base</h1>
                    <p class="page-subtitle">Learn ERP concepts, GST compliance, and business best practices</p>
                </div>

                <div class="kb-stats-strip">
                    <div class="kb-stat-chip">
                        <div class="kb-stat-icon" style="background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(99,102,241,0.05));">ðŸ“š</div>
                        <div class="kb-stat-info">
                            <div class="kb-stat-val">${kbArticles.length}</div>
                            <div class="kb-stat-label">Articles</div>
                        </div>
                    </div>
                    <div class="kb-stat-chip">
                        <div class="kb-stat-icon" style="background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(16,185,129,0.05));">ðŸ“‚</div>
                        <div class="kb-stat-info">
                            <div class="kb-stat-val">${kbCategories.length - 1}</div>
                            <div class="kb-stat-label">Categories</div>
                        </div>
                    </div>
                    <div class="kb-stat-chip">
                        <div class="kb-stat-icon" style="background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.05));">â­</div>
                        <div class="kb-stat-info">
                            <div class="kb-stat-val">${bookmarkCount}</div>
                            <div class="kb-stat-label">Bookmarked</div>
                        </div>
                    </div>
                    <div class="kb-stat-chip">
                        <div class="kb-stat-icon" style="background: linear-gradient(135deg, rgba(236,72,153,0.15), rgba(236,72,153,0.05));">â±</div>
                        <div class="kb-stat-info">
                            <div class="kb-stat-val">${kbArticles.reduce((s, a) => s + a.readTime, 0)} min</div>
                            <div class="kb-stat-label">Total Reading</div>
                        </div>
                    </div>
                </div>

                <div class="kb-search-container">
                    <svg class="kb-search-icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input type="text" id="kbSearchInput" placeholder="Search articles by title, category, or keyword..." value="${kbSearchQuery}" oninput="kbSearch(this.value)">
                </div>

                <div class="kb-categories" id="kbCategories">
                    ${kbCategories.map(cat => `
                        <button class="kb-category-pill ${kbActiveCategory === cat ? 'active' : ''}" onclick="kbFilterCategory('${cat}')">
                            ${cat}
                            ${cat !== 'All' ? `<span class="pill-count">${categoryCountMap[cat] || 0}</span>` : `<span class="pill-count">${kbArticles.length}</span>`}
                        </button>
                    `).join('')}
                    <button class="kb-category-pill ${kbActiveCategory === 'Bookmarked' ? 'active' : ''}" onclick="kbFilterCategory('Bookmarked')" style="margin-left: auto;">
                        â­ Bookmarked
                        <span class="pill-count">${bookmarkCount}</span>
                    </button>
                </div>

                <div id="kbArticlesList">
                    ${renderKBArticles()}
                </div>
            `;
        }

        function renderKBArticles() {
            let filtered = kbArticles;

            if (kbActiveCategory === 'Bookmarked') {
                filtered = filtered.filter(a => kbBookmarks.includes(a.id));
            } else if (kbActiveCategory !== 'All') {
                filtered = filtered.filter(a => a.category === kbActiveCategory);
            }

            if (kbSearchQuery.trim()) {
                const q = kbSearchQuery.toLowerCase();
                filtered = filtered.filter(a =>
                    a.title.toLowerCase().includes(q) ||
                    a.category.toLowerCase().includes(q) ||
                    a.summary.toLowerCase().includes(q) ||
                    a.content.toLowerCase().includes(q)
                );
            }

            if (filtered.length === 0) {
                return `
                    <div class="kb-no-results">
                        <div class="kb-no-icon">ðŸ”</div>
                        <h3>No articles found</h3>
                        <p>Try a different search term or category filter.</p>
                    </div>
                `;
            }

            return filtered.map(article => {
                const isBookmarked = kbBookmarks.includes(article.id);
                const isExpanded = kbExpandedArticle === article.id;
                const diffClass = 'kb-tag-' + article.difficulty;
                const diffLabel = article.difficulty.charAt(0).toUpperCase() + article.difficulty.slice(1);

                let displayTitle = article.title;
                let displaySummary = article.summary;
                if (kbSearchQuery.trim()) {
                    const re = new RegExp(`(${kbSearchQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                    displayTitle = displayTitle.replace(re, '<span class="kb-highlight">$1</span>');
                    displaySummary = displaySummary.replace(re, '<span class="kb-highlight">$1</span>');
                }

                const relatedArticles = (article.related || []).map(rid => kbArticles.find(a => a.id === rid)).filter(Boolean);

                return `
                    <div class="kb-article-card ${isExpanded ? 'expanded' : ''}" id="${article.id}">
                        <div class="kb-article-header" onclick="kbToggleArticle('${article.id}')">
                            <div class="kb-article-icon" style="background: ${article.iconBg}; color: white;">${article.icon}</div>
                            <div class="kb-article-info">
                                <div class="kb-article-title">${displayTitle}</div>
                                <div class="kb-article-meta">
                                    <span class="kb-tag ${diffClass}">${diffLabel}</span>
                                    <span>${article.category}</span>
                                    <span class="kb-read-time">
                                        <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                        ${article.readTime} min read
                                    </span>
                                </div>
                            </div>
                            <div class="kb-article-actions">
                                <button class="kb-bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" onclick="event.stopPropagation(); kbToggleBookmark('${article.id}')" title="${isBookmarked ? 'Remove Bookmark' : 'Bookmark'}">
                                    ${isBookmarked ? 'â˜…' : 'â˜†'}
                                </button>
                                <button class="kb-expand-btn ${isExpanded ? 'expanded' : ''}">
                                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="kb-article-body">
                            <div class="kb-article-content">
                                <p style="margin-bottom: 12px; font-size: 14px; color: var(--text-light);">${displaySummary}</p>
                                ${article.content}
                                ${relatedArticles.length > 0 ? `
                                    <div class="kb-related-nav">
                                        <span style="font-size: 12px; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 4px;">ðŸ”— Related:</span>
                                        ${relatedArticles.map(ra => `
                                            <button class="kb-related-link" onclick="event.stopPropagation(); kbNavigateTo('${ra.id}')">${ra.icon} ${ra.title.split('â€”')[0].trim()}</button>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function kbSearch(query) {
            kbSearchQuery = query;
            document.getElementById('kbArticlesList').innerHTML = renderKBArticles();
        }

        function kbFilterCategory(cat) {
            kbActiveCategory = cat;
            kbExpandedArticle = null;
            loadKnowledgeBase();
        }

        function kbToggleArticle(articleId) {
            kbExpandedArticle = kbExpandedArticle === articleId ? null : articleId;
            document.getElementById('kbArticlesList').innerHTML = renderKBArticles();
            if (kbExpandedArticle) {
                setTimeout(() => {
                    document.getElementById(articleId)?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
        }

        function kbToggleBookmark(articleId) {
            if (kbBookmarks.includes(articleId)) {
                kbBookmarks = kbBookmarks.filter(id => id !== articleId);
                showNotification('Bookmark Removed', 'Article removed from bookmarks');
            } else {
                kbBookmarks.push(articleId);
                showNotification('Bookmarked! â­', 'Article saved to your bookmarks');
            }
            localStorage.setItem('erpKBBookmarks', JSON.stringify(kbBookmarks));
            loadKnowledgeBase();
        }

        function kbNavigateTo(articleId) {
            kbExpandedArticle = articleId;
            kbActiveCategory = 'All';
            kbSearchQuery = '';
            loadKnowledgeBase();
            setTimeout(() => {
                document.getElementById(articleId)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 150);
        }

        // ============ COMPANY SANDBOX ============

        const sandboxCompanies = [
            {
                id: 'technova',
                name: 'TechNova Solutions',
                industry: 'IT Services & Software',
                icon: 'ðŸ’»',
                gradient: 'linear-gradient(135deg, #6366f1, #8b5cf6)',
                logoBg: '#4f46e5',
                tags: ['B2B', 'IT Services', '18% GST'],
                description: 'A mid-size IT services company providing laptops, networking equipment, and software licenses to corporates. High-value orders with 18% GST on electronics.',
                inventory: [
                    { id: 1, name: 'Dell Latitude 5540 Laptop', sku: 'TN-LAP-001', hsnCode: '8471', gstRate: 18, quantity: 65, price: 72000, category: 'Laptops', status: 'In Stock' },
                    { id: 2, name: 'HP ProBook 450 G10', sku: 'TN-LAP-002', hsnCode: '8471', gstRate: 18, quantity: 38, price: 58000, category: 'Laptops', status: 'In Stock' },
                    { id: 3, name: 'Cisco Catalyst Switch 24-Port', sku: 'TN-NET-001', hsnCode: '8517', gstRate: 18, quantity: 14, price: 95000, category: 'Networking', status: 'Low Stock' },
                    { id: 4, name: 'APC Smart UPS 1500VA', sku: 'TN-UPS-001', hsnCode: '8504', gstRate: 18, quantity: 22, price: 18500, category: 'Power', status: 'In Stock' },
                    { id: 5, name: 'Microsoft 365 Business License', sku: 'TN-SW-001', hsnCode: '8523', gstRate: 18, quantity: 200, price: 8400, category: 'Software', status: 'In Stock' },
                    { id: 6, name: 'Logitech MK295 Keyboard-Mouse Combo', sku: 'TN-ACC-001', hsnCode: '8471', gstRate: 18, quantity: 85, price: 2200, category: 'Accessories', status: 'In Stock' },
                    { id: 7, name: 'Dell 27" UltraSharp Monitor', sku: 'TN-MON-001', hsnCode: '8528', gstRate: 18, quantity: 8, price: 42000, category: 'Displays', status: 'Critical' },
                    { id: 8, name: 'Cat 6 Ethernet Cable (Box 305m)', sku: 'TN-NET-002', hsnCode: '8544', gstRate: 18, quantity: 30, price: 6500, category: 'Networking', status: 'In Stock' }
                ],
                sales: [
                    { id: 1, orderNumber: 'TN-SO-001', customer: 'Infosys Ltd', amount: 885600, gstRate: 18, taxableAmount: 750508.47, cgst: 67545.76, sgst: 67545.76, totalWithGst: 885600, date: '2024-03-01', status: 'Completed' },
                    { id: 2, orderNumber: 'TN-SO-002', customer: 'Wipro Technologies', amount: 543400, gstRate: 18, taxableAmount: 460508.47, cgst: 41445.76, sgst: 41445.76, totalWithGst: 543400, date: '2024-03-05', status: 'Completed' },
                    { id: 3, orderNumber: 'TN-SO-003', customer: 'TCS Digital', amount: 1254000, gstRate: 18, taxableAmount: 1062711.86, cgst: 95644.07, sgst: 95644.07, totalWithGst: 1254000, date: '2024-03-08', status: 'Processing' },
                    { id: 4, orderNumber: 'TN-SO-004', customer: 'Zoho Corp', amount: 296800, gstRate: 18, taxableAmount: 251525.42, cgst: 22637.29, sgst: 22637.29, totalWithGst: 296800, date: '2024-03-10', status: 'Pending' },
                    { id: 5, orderNumber: 'TN-SO-005', customer: 'Freshworks Inc', amount: 720000, gstRate: 18, taxableAmount: 610169.49, cgst: 54915.25, sgst: 54915.25, totalWithGst: 720000, date: '2024-03-12', status: 'Completed' }
                ],
                purchases: [
                    { id: 1, poNumber: 'TN-PO-001', supplier: 'Dell India Pvt Ltd', amount: 2160000, gstRate: 18, taxableAmount: 1830508.47, cgst: 164745.76, sgst: 164745.76, totalWithGst: 2160000, date: '2024-02-20', status: 'Received' },
                    { id: 2, poNumber: 'TN-PO-002', supplier: 'Cisco Systems India', amount: 1330000, gstRate: 18, taxableAmount: 1127118.64, cgst: 101440.68, sgst: 101440.68, totalWithGst: 1330000, date: '2024-02-25', status: 'Received' },
                    { id: 3, poNumber: 'TN-PO-003', supplier: 'Microsoft India', amount: 840000, gstRate: 18, taxableAmount: 711864.41, cgst: 64067.80, sgst: 64067.80, totalWithGst: 840000, date: '2024-03-01', status: 'Pending' }
                ],
                employees: [
                    { id: 1, name: 'Rajesh Kumar', position: 'CTO', department: 'Engineering', salary: 2400000, email: 'rajesh@technova.in', status: 'Active' },
                    { id: 2, name: 'Priya Sharma', position: 'Sales Director', department: 'Sales', salary: 1800000, email: 'priya@technova.in', status: 'Active' },
                    { id: 3, name: 'Amit Patel', position: 'Network Engineer', department: 'Engineering', salary: 900000, email: 'amit@technova.in', status: 'Active' },
                    { id: 4, name: 'Neha Gupta', position: 'HR Manager', department: 'HR', salary: 1200000, email: 'neha@technova.in', status: 'Active' },
                    { id: 5, name: 'Vikram Singh', position: 'Account Manager', department: 'Sales', salary: 1000000, email: 'vikram@technova.in', status: 'Active' }
                ]
            },
            {
                id: 'freshmart',
                name: 'FreshMart Groceries',
                industry: 'Retail & FMCG',
                icon: 'ðŸ›’',
                gradient: 'linear-gradient(135deg, #10b981, #059669)',
                logoBg: '#059669',
                tags: ['B2C', 'Retail', 'Mixed GST'],
                description: 'A grocery retail chain selling fresh produce (0% GST), packaged food (5%), and household items (18%). Great for learning mixed GST rate handling.',
                inventory: [
                    { id: 1, name: 'Basmati Rice Premium 5kg', sku: 'FM-GRN-001', hsnCode: '1006', gstRate: 5, quantity: 200, price: 450, category: 'Grains', status: 'In Stock' },
                    { id: 2, name: 'Amul Butter 500g', sku: 'FM-DRY-001', hsnCode: '0405', gstRate: 12, quantity: 120, price: 270, category: 'Dairy', status: 'In Stock' },
                    { id: 3, name: 'Fresh Apples (per kg)', sku: 'FM-FRT-001', hsnCode: '0808', gstRate: 0, quantity: 80, price: 180, category: 'Fruits', status: 'In Stock' },
                    { id: 4, name: 'Surf Excel Detergent 2kg', sku: 'FM-HH-001', hsnCode: '3402', gstRate: 18, quantity: 60, price: 320, category: 'Household', status: 'In Stock' },
                    { id: 5, name: 'Tata Tea Gold 500g', sku: 'FM-BEV-001', hsnCode: '0902', gstRate: 5, quantity: 95, price: 280, category: 'Beverages', status: 'In Stock' },
                    { id: 6, name: 'Organic Honey 500g', sku: 'FM-NUT-001', hsnCode: '0409', gstRate: 0, quantity: 15, price: 550, category: 'Natural', status: 'Low Stock' },
                    { id: 7, name: 'Maggi Noodles Family Pack', sku: 'FM-PKG-001', hsnCode: '1902', gstRate: 12, quantity: 180, price: 120, category: 'Packaged Food', status: 'In Stock' },
                    { id: 8, name: 'Colgate MaxFresh 150g', sku: 'FM-PC-001', hsnCode: '3306', gstRate: 18, quantity: 7, price: 110, category: 'Personal Care', status: 'Critical' },
                    { id: 9, name: 'Dettol Handwash 900ml', sku: 'FM-PC-002', hsnCode: '3401', gstRate: 18, quantity: 45, price: 195, category: 'Personal Care', status: 'In Stock' },
                    { id: 10, name: 'Fresh Paneer 200g', sku: 'FM-DRY-002', hsnCode: '0406', gstRate: 0, quantity: 30, price: 90, category: 'Dairy', status: 'In Stock' }
                ],
                sales: [
                    { id: 1, orderNumber: 'FM-SO-001', customer: 'Walk-in Customer', amount: 2450, gstRate: 5, taxableAmount: 2333.33, cgst: 58.33, sgst: 58.33, totalWithGst: 2450, date: '2024-03-15', status: 'Completed' },
                    { id: 2, orderNumber: 'FM-SO-002', customer: 'Hotel Grand Palace', amount: 18500, gstRate: 5, taxableAmount: 17619.05, cgst: 440.48, sgst: 440.48, totalWithGst: 18500, date: '2024-03-14', status: 'Completed' },
                    { id: 3, orderNumber: 'FM-SO-003', customer: 'Canteen Services Ltd', amount: 35200, gstRate: 12, taxableAmount: 31428.57, cgst: 1885.71, sgst: 1885.71, totalWithGst: 35200, date: '2024-03-13', status: 'Completed' },
                    { id: 4, orderNumber: 'FM-SO-004', customer: 'Event Catering Co', amount: 12800, gstRate: 5, taxableAmount: 12190.48, cgst: 304.76, sgst: 304.76, totalWithGst: 12800, date: '2024-03-12', status: 'Processing' },
                    { id: 5, orderNumber: 'FM-SO-005', customer: 'Local Restaurant', amount: 8950, gstRate: 5, taxableAmount: 8523.81, cgst: 213.10, sgst: 213.10, totalWithGst: 8950, date: '2024-03-10', status: 'Pending' }
                ],
                purchases: [
                    { id: 1, poNumber: 'FM-PO-001', supplier: 'Amul Dairy Cooperative', amount: 85000, gstRate: 12, taxableAmount: 75892.86, cgst: 4553.57, sgst: 4553.57, totalWithGst: 85000, date: '2024-03-01', status: 'Received' },
                    { id: 2, poNumber: 'FM-PO-002', supplier: 'Local Farm Produce', amount: 42000, gstRate: 0, taxableAmount: 42000, cgst: 0, sgst: 0, totalWithGst: 42000, date: '2024-03-05', status: 'Received' },
                    { id: 3, poNumber: 'FM-PO-003', supplier: 'HUL Distributors', amount: 125000, gstRate: 18, taxableAmount: 105932.20, cgst: 9533.90, sgst: 9533.90, totalWithGst: 125000, date: '2024-03-08', status: 'Pending' },
                    { id: 4, poNumber: 'FM-PO-004', supplier: 'Tata Consumer Products', amount: 68000, gstRate: 5, taxableAmount: 64761.90, cgst: 1619.05, sgst: 1619.05, totalWithGst: 68000, date: '2024-03-10', status: 'Received' }
                ],
                employees: [
                    { id: 1, name: 'Suresh Agarwal', position: 'Store Manager', department: 'Operations', salary: 600000, email: 'suresh@freshmart.in', status: 'Active' },
                    { id: 2, name: 'Meena Devi', position: 'Cashier Supervisor', department: 'Operations', salary: 360000, email: 'meena@freshmart.in', status: 'Active' },
                    { id: 3, name: 'Ravi Teja', position: 'Procurement Head', department: 'Purchasing', salary: 540000, email: 'ravi@freshmart.in', status: 'Active' },
                    { id: 4, name: 'Anita Roy', position: 'Accounts Officer', department: 'Finance', salary: 480000, email: 'anita@freshmart.in', status: 'Active' }
                ]
            },
            {
                id: 'steelforge',
                name: 'SteelForge Industries',
                industry: 'Manufacturing & Heavy Goods',
                icon: 'ðŸ­',
                gradient: 'linear-gradient(135deg, #f59e0b, #d97706)',
                logoBg: '#d97706',
                tags: ['B2B', 'Manufacturing', '18% GST'],
                description: 'A steel manufacturing company dealing in raw materials, finished steel products, and industrial equipment. High-volume B2B orders with transport logistics.',
                inventory: [
                    { id: 1, name: 'MS Steel Plate 10mm (per ton)', sku: 'SF-STL-001', hsnCode: '7208', gstRate: 18, quantity: 50, price: 62000, category: 'Raw Steel', status: 'In Stock' },
                    { id: 2, name: 'TMT Steel Bars Fe-500 (per ton)', sku: 'SF-STL-002', hsnCode: '7214', gstRate: 18, quantity: 120, price: 55000, category: 'Construction Steel', status: 'In Stock' },
                    { id: 3, name: 'Industrial Welding Rod 3.15mm (box)', sku: 'SF-WLD-001', hsnCode: '8311', gstRate: 18, quantity: 300, price: 1800, category: 'Consumables', status: 'In Stock' },
                    { id: 4, name: 'Hydraulic Press Machine', sku: 'SF-MCH-001', hsnCode: '8462', gstRate: 18, quantity: 3, price: 850000, category: 'Machinery', status: 'Low Stock' },
                    { id: 5, name: 'Safety Helmet ISI Marked', sku: 'SF-SAF-001', hsnCode: '6506', gstRate: 18, quantity: 200, price: 450, category: 'Safety Gear', status: 'In Stock' },
                    { id: 6, name: 'Stainless Steel Sheet 304 (per kg)', sku: 'SF-SS-001', hsnCode: '7219', gstRate: 18, quantity: 5000, price: 280, category: 'Stainless Steel', status: 'In Stock' }
                ],
                sales: [
                    { id: 1, orderNumber: 'SF-SO-001', customer: 'L&T Construction', amount: 4720000, gstRate: 18, taxableAmount: 4000000, cgst: 360000, sgst: 360000, totalWithGst: 4720000, date: '2024-02-28', status: 'Completed' },
                    { id: 2, orderNumber: 'SF-SO-002', customer: 'Tata Projects Ltd', amount: 2832000, gstRate: 18, taxableAmount: 2400000, cgst: 216000, sgst: 216000, totalWithGst: 2832000, date: '2024-03-02', status: 'Completed' },
                    { id: 3, orderNumber: 'SF-SO-003', customer: 'Godrej Construction', amount: 1652000, gstRate: 18, taxableAmount: 1400000, cgst: 126000, sgst: 126000, totalWithGst: 1652000, date: '2024-03-06', status: 'Processing' },
                    { id: 4, orderNumber: 'SF-SO-004', customer: 'Shapoorji Pallonji', amount: 3540000, gstRate: 18, taxableAmount: 3000000, cgst: 270000, sgst: 270000, totalWithGst: 3540000, date: '2024-03-09', status: 'Pending' }
                ],
                purchases: [
                    { id: 1, poNumber: 'SF-PO-001', supplier: 'SAIL (Steel Authority)', amount: 7080000, gstRate: 18, taxableAmount: 6000000, cgst: 540000, sgst: 540000, totalWithGst: 7080000, date: '2024-02-15', status: 'Received' },
                    { id: 2, poNumber: 'SF-PO-002', supplier: 'Tata Steel Ltd', amount: 4130000, gstRate: 18, taxableAmount: 3500000, cgst: 315000, sgst: 315000, totalWithGst: 4130000, date: '2024-02-22', status: 'Received' },
                    { id: 3, poNumber: 'SF-PO-003', supplier: 'Jindal Steel', amount: 2360000, gstRate: 18, taxableAmount: 2000000, cgst: 180000, sgst: 180000, totalWithGst: 2360000, date: '2024-03-01', status: 'Pending' }
                ],
                employees: [
                    { id: 1, name: 'Harish Mehta', position: 'Plant Director', department: 'Operations', salary: 2100000, email: 'harish@steelforge.in', status: 'Active' },
                    { id: 2, name: 'Ramesh Yadav', position: 'Production Manager', department: 'Manufacturing', salary: 1200000, email: 'ramesh@steelforge.in', status: 'Active' },
                    { id: 3, name: 'Sunita Joshi', position: 'Quality Inspector', department: 'Quality', salary: 780000, email: 'sunita@steelforge.in', status: 'Active' },
                    { id: 4, name: 'Deepak Verma', position: 'Safety Officer', department: 'Safety', salary: 720000, email: 'deepak@steelforge.in', status: 'Active' },
                    { id: 5, name: 'Kavita Nair', position: 'Accounts Manager', department: 'Finance', salary: 960000, email: 'kavita@steelforge.in', status: 'Active' },
                    { id: 6, name: 'Mahesh Kulkarni', position: 'Dispatch Supervisor', department: 'Logistics', salary: 540000, email: 'mahesh@steelforge.in', status: 'Active' }
                ]
            },
            {
                id: 'cafemocha',
                name: 'CafÃ© Mocha Chain',
                industry: 'Food & Beverage',
                icon: 'â˜•',
                gradient: 'linear-gradient(135deg, #92400e, #b45309)',
                logoBg: '#92400e',
                tags: ['B2C', 'Food Service', '5% GST'],
                description: 'A popular cafÃ© chain serving coffee, pastries, and snacks. Most items at 5% GST (restaurant services). Learn hospitality-specific ERP workflows.',
                inventory: [
                    { id: 1, name: 'Arabica Coffee Beans 1kg', sku: 'CM-COF-001', hsnCode: '0901', gstRate: 5, quantity: 50, price: 1200, category: 'Coffee', status: 'In Stock' },
                    { id: 2, name: 'Whole Milk 500ml Tetrapak (case)', sku: 'CM-DRY-001', hsnCode: '0401', gstRate: 0, quantity: 80, price: 1600, category: 'Dairy', status: 'In Stock' },
                    { id: 3, name: 'Belgian Chocolate Sauce 2L', sku: 'CM-SYR-001', hsnCode: '1806', gstRate: 12, quantity: 18, price: 850, category: 'Syrups', status: 'Low Stock' },
                    { id: 4, name: 'Croissant Dough Frozen (pack 20)', sku: 'CM-BKY-001', hsnCode: '1905', gstRate: 5, quantity: 25, price: 680, category: 'Bakery', status: 'In Stock' },
                    { id: 5, name: 'Paper Cups 12oz (sleeve 50)', sku: 'CM-PKG-001', hsnCode: '4823', gstRate: 12, quantity: 100, price: 220, category: 'Packaging', status: 'In Stock' },
                    { id: 6, name: 'Vanilla Syrup 750ml', sku: 'CM-SYR-002', hsnCode: '2106', gstRate: 12, quantity: 35, price: 420, category: 'Syrups', status: 'In Stock' },
                    { id: 7, name: 'Green Tea Matcha Powder 250g', sku: 'CM-TEA-001', hsnCode: '0902', gstRate: 5, quantity: 12, price: 1800, category: 'Tea', status: 'Low Stock' }
                ],
                sales: [
                    { id: 1, orderNumber: 'CM-SO-001', customer: 'Daily In-Store Sales', amount: 45500, gstRate: 5, taxableAmount: 43333.33, cgst: 1083.33, sgst: 1083.33, totalWithGst: 45500, date: '2024-03-15', status: 'Completed' },
                    { id: 2, orderNumber: 'CM-SO-002', customer: 'Corporate Office Catering', amount: 28000, gstRate: 5, taxableAmount: 26666.67, cgst: 666.67, sgst: 666.67, totalWithGst: 28000, date: '2024-03-14', status: 'Completed' },
                    { id: 3, orderNumber: 'CM-SO-003', customer: 'Swiggy/Zomato Orders', amount: 62000, gstRate: 5, taxableAmount: 59047.62, cgst: 1476.19, sgst: 1476.19, totalWithGst: 62000, date: '2024-03-13', status: 'Completed' },
                    { id: 4, orderNumber: 'CM-SO-004', customer: 'Birthday Party Event', amount: 15500, gstRate: 5, taxableAmount: 14761.90, cgst: 369.05, sgst: 369.05, totalWithGst: 15500, date: '2024-03-12', status: 'Processing' }
                ],
                purchases: [
                    { id: 1, poNumber: 'CM-PO-001', supplier: 'Blue Tokai Coffee Roasters', amount: 48000, gstRate: 5, taxableAmount: 45714.29, cgst: 1142.86, sgst: 1142.86, totalWithGst: 48000, date: '2024-03-01', status: 'Received' },
                    { id: 2, poNumber: 'CM-PO-002', supplier: 'Heritage Dairy', amount: 32000, gstRate: 0, taxableAmount: 32000, cgst: 0, sgst: 0, totalWithGst: 32000, date: '2024-03-05', status: 'Received' },
                    { id: 3, poNumber: 'CM-PO-003', supplier: 'Packaging World India', amount: 18500, gstRate: 12, taxableAmount: 16517.86, cgst: 991.07, sgst: 991.07, totalWithGst: 18500, date: '2024-03-08', status: 'Pending' }
                ],
                employees: [
                    { id: 1, name: 'Arjun Reddy', position: 'CafÃ© Manager', department: 'Operations', salary: 480000, email: 'arjun@cafemocha.in', status: 'Active' },
                    { id: 2, name: 'Divya Krishnan', position: 'Head Barista', department: 'Operations', salary: 360000, email: 'divya@cafemocha.in', status: 'Active' },
                    { id: 3, name: 'Sneha Pillai', position: 'Pastry Chef', department: 'Kitchen', salary: 420000, email: 'sneha@cafemocha.in', status: 'Active' }
                ]
            },
            {
                id: 'medicare',
                name: 'MediCare Pharma',
                industry: 'Pharmaceutical & Healthcare',
                icon: 'ðŸ’Š',
                gradient: 'linear-gradient(135deg, #0ea5e9, #0284c7)',
                logoBg: '#0284c7',
                tags: ['B2B/B2C', 'Pharma', '12% GST'],
                description: 'A pharmaceutical distributor handling medicines, medical devices, and healthcare supplies. Most pharma products @ 12% GST with strict regulatory requirements.',
                inventory: [
                    { id: 1, name: 'Paracetamol 500mg (strip 10)', sku: 'MC-MED-001', hsnCode: '3004', gstRate: 12, quantity: 500, price: 28, category: 'Medicines', status: 'In Stock' },
                    { id: 2, name: 'Digital Thermometer', sku: 'MC-DEV-001', hsnCode: '9025', gstRate: 12, quantity: 75, price: 350, category: 'Devices', status: 'In Stock' },
                    { id: 3, name: 'Surgical Gloves (box 100)', sku: 'MC-SUP-001', hsnCode: '4015', gstRate: 12, quantity: 60, price: 480, category: 'Supplies', status: 'In Stock' },
                    { id: 4, name: 'Vitamin D3 Supplements (60 caps)', sku: 'MC-NUT-001', hsnCode: '2936', gstRate: 12, quantity: 200, price: 420, category: 'Nutraceuticals', status: 'In Stock' },
                    { id: 5, name: 'BP Monitor Omron HEM-7120', sku: 'MC-DEV-002', hsnCode: '9018', gstRate: 12, quantity: 9, price: 1800, category: 'Devices', status: 'Critical' },
                    { id: 6, name: 'Cetrizine 10mg (strip 10)', sku: 'MC-MED-002', hsnCode: '3004', gstRate: 12, quantity: 350, price: 35, category: 'Medicines', status: 'In Stock' },
                    { id: 7, name: 'Pulse Oximeter', sku: 'MC-DEV-003', hsnCode: '9018', gstRate: 12, quantity: 20, price: 1200, category: 'Devices', status: 'Low Stock' },
                    { id: 8, name: 'N95 Face Mask (box 20)', sku: 'MC-SUP-002', hsnCode: '6307', gstRate: 5, quantity: 150, price: 280, category: 'Supplies', status: 'In Stock' }
                ],
                sales: [
                    { id: 1, orderNumber: 'MC-SO-001', customer: 'Apollo Hospitals', amount: 245000, gstRate: 12, taxableAmount: 218750, cgst: 13125, sgst: 13125, totalWithGst: 245000, date: '2024-03-10', status: 'Completed' },
                    { id: 2, orderNumber: 'MC-SO-002', customer: 'Medplus Pharmacy Chain', amount: 189000, gstRate: 12, taxableAmount: 168750, cgst: 10125, sgst: 10125, totalWithGst: 189000, date: '2024-03-08', status: 'Completed' },
                    { id: 3, orderNumber: 'MC-SO-003', customer: 'AIIMS Delhi', amount: 520000, gstRate: 12, taxableAmount: 464285.71, cgst: 27857.14, sgst: 27857.14, totalWithGst: 520000, date: '2024-03-05', status: 'Processing' },
                    { id: 4, orderNumber: 'MC-SO-004', customer: 'Practo Health Clinic', amount: 78000, gstRate: 12, taxableAmount: 69642.86, cgst: 4178.57, sgst: 4178.57, totalWithGst: 78000, date: '2024-03-03', status: 'Pending' },
                    { id: 5, orderNumber: 'MC-SO-005', customer: 'Max Healthcare', amount: 340000, gstRate: 12, taxableAmount: 303571.43, cgst: 18214.29, sgst: 18214.29, totalWithGst: 340000, date: '2024-03-01', status: 'Completed' }
                ],
                purchases: [
                    { id: 1, poNumber: 'MC-PO-001', supplier: 'Sun Pharma Industries', amount: 380000, gstRate: 12, taxableAmount: 339285.71, cgst: 20357.14, sgst: 20357.14, totalWithGst: 380000, date: '2024-02-20', status: 'Received' },
                    { id: 2, poNumber: 'MC-PO-002', supplier: 'Cipla Ltd', amount: 265000, gstRate: 12, taxableAmount: 236607.14, cgst: 14196.43, sgst: 14196.43, totalWithGst: 265000, date: '2024-02-25', status: 'Received' },
                    { id: 3, poNumber: 'MC-PO-003', supplier: 'Omron Healthcare', amount: 156000, gstRate: 12, taxableAmount: 139285.71, cgst: 8357.14, sgst: 8357.14, totalWithGst: 156000, date: '2024-03-01', status: 'Pending' }
                ],
                employees: [
                    { id: 1, name: 'Dr. Sanjay Rao', position: 'Managing Director', department: 'Management', salary: 2400000, email: 'sanjay@medicare.in', status: 'Active' },
                    { id: 2, name: 'Lakshmi Iyer', position: 'Supply Chain Head', department: 'Logistics', salary: 1320000, email: 'lakshmi@medicare.in', status: 'Active' },
                    { id: 3, name: 'Farhan Khan', position: 'Quality Assurance', department: 'Quality', salary: 900000, email: 'farhan@medicare.in', status: 'Active' },
                    { id: 4, name: 'Pooja Deshmukh', position: 'Pharmacist', department: 'Operations', salary: 660000, email: 'pooja@medicare.in', status: 'Active' },
                    { id: 5, name: 'Nitin Jain', position: 'Finance Controller', department: 'Finance', salary: 1440000, email: 'nitin@medicare.in', status: 'Active' }
                ]
            }
        ];

        let activeSandbox = localStorage.getItem('activeSandbox') || null;

        function loadSandbox() {
            const activeCompany = activeSandbox ? sandboxCompanies.find(c => c.id === activeSandbox) : null;

            document.getElementById('pageContent').innerHTML = `
                <div class="page-header">
                    <h1 class="page-title">Company Sandbox</h1>
                    <p class="page-subtitle">Load real-world company data to practice ERP operations across different industries</p>
                </div>

                ${activeCompany ? `
                    <div class="sandbox-active-banner">
                        <div class="sandbox-active-icon" style="background: ${activeCompany.gradient}; color: white;">${activeCompany.icon}</div>
                        <div class="sandbox-active-info">
                            <h4>Currently Active: ${activeCompany.name}</h4>
                            <p>${activeCompany.industry} â€” All modules are loaded with this company's data. Explore Dashboard, Inventory, Sales, etc.</p>
                        </div>
                        <button class="sandbox-reset-btn" onclick="resetSandbox()">âŸ² Reset to Default</button>
                    </div>
                ` : `
                    <div class="hint-box" style="margin-bottom: 24px;">
                        <div class="hint-header">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            How It Works
                        </div>
                        <div class="hint-content">
                            Choose a company below to load its data into the ERP system. The Inventory, Sales, Purchases, and HR modules will be populated with that company's realistic business data. You can explore, add records, generate reports, and practice all ERP operations. Reset anytime to go back to the default data.
                        </div>
                    </div>
                `}

                <div class="sandbox-grid">
                    ${sandboxCompanies.map(company => {
                const totalRev = company.sales.reduce((s, o) => s + o.amount, 0);
                const isActive = activeSandbox === company.id;
                return `
                            <div class="sandbox-company-card ${isActive ? 'active-sandbox' : ''}">
                                <div class="sandbox-card-header" style="background: ${company.gradient};">
                                    <div class="sandbox-logo" style="background: ${company.logoBg}; color: white;">${company.icon}</div>
                                    <h3>${company.name}</h3>
                                    <div class="sandbox-industry">${company.industry}</div>
                                    <div class="sandbox-tag-row">
                                        ${company.tags.map(t => `<span class="sandbox-tag">${t}</span>`).join('')}
                                    </div>
                                </div>
                                <div class="sandbox-card-body">
                                    <div class="sandbox-desc">${company.description}</div>
                                    <div class="sandbox-stats-grid">
                                        <div class="sandbox-stat-item">
                                            <div class="sandbox-stat-val">${company.inventory.length}</div>
                                            <div class="sandbox-stat-lbl">Products</div>
                                        </div>
                                        <div class="sandbox-stat-item">
                                            <div class="sandbox-stat-val">${company.sales.length}</div>
                                            <div class="sandbox-stat-lbl">Sales Orders</div>
                                        </div>
                                        <div class="sandbox-stat-item">
                                            <div class="sandbox-stat-val">${company.employees.length}</div>
                                            <div class="sandbox-stat-lbl">Employees</div>
                                        </div>
                                        <div class="sandbox-stat-item">
                                            <div class="sandbox-stat-val">${formatCurrency(totalRev).split('.')[0]}</div>
                                            <div class="sandbox-stat-lbl">Total Revenue</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="sandbox-card-footer">
                                    ${isActive ? `
                                        <button class="sandbox-load-btn outline" onclick="viewSandboxDetails('${company.id}')">ðŸ“Š View Details</button>
                                        <button class="sandbox-load-btn outline" style="border-color: #ef4444; color: #ef4444;" onclick="resetSandbox()">Reset</button>
                                    ` : `
                                        <button class="sandbox-load-btn primary" onclick="loadSandboxData('${company.id}')">ðŸš€ Load Sandbox</button>
                                        <button class="sandbox-load-btn outline" onclick="viewSandboxDetails('${company.id}')">Preview</button>
                                    `}
                                </div>
                            </div>
                        `;
            }).join('')}
                </div>
            `;
        }

        function loadSandboxData(companyId) {
            const company = sandboxCompanies.find(c => c.id === companyId);
            if (!company) return;

            if (!confirm(`Load "${company.name}" data?\n\nThis will replace your current Inventory, Sales, Purchases, and HR data with ${company.name}'s business data.\n\nYour original data will be backed up and can be restored using the "Reset to Default" button.`)) return;

            // Backup current data
            localStorage.setItem('backup_inventory', JSON.stringify(appData.inventory));
            localStorage.setItem('backup_sales', JSON.stringify(appData.sales));
            localStorage.setItem('backup_purchases', JSON.stringify(appData.purchases));
            localStorage.setItem('backup_employees', JSON.stringify(appData.employees));

            // Load company data
            appData.inventory = JSON.parse(JSON.stringify(company.inventory));
            appData.sales = JSON.parse(JSON.stringify(company.sales));
            appData.purchases = JSON.parse(JSON.stringify(company.purchases));
            appData.employees = JSON.parse(JSON.stringify(company.employees));

            // Save to localStorage
            saveData('inventory');
            saveData('sales');
            saveData('purchases');
            saveData('employees');

            // Track active sandbox
            activeSandbox = companyId;
            localStorage.setItem('activeSandbox', companyId);

            showNotification(`${company.icon} ${company.name} Loaded!`, `All modules now contain ${company.name}'s data. Explore the Dashboard to start!`);
            loadSandbox();
        }

        function resetSandbox() {
            if (!confirm('Reset to default data?\n\nThis will restore the original ERP data and remove the current sandbox company data.')) return;

            const backupInv = localStorage.getItem('backup_inventory');
            const backupSales = localStorage.getItem('backup_sales');
            const backupPurchases = localStorage.getItem('backup_purchases');
            const backupEmployees = localStorage.getItem('backup_employees');

            if (backupInv) appData.inventory = JSON.parse(backupInv);
            if (backupSales) appData.sales = JSON.parse(backupSales);
            if (backupPurchases) appData.purchases = JSON.parse(backupPurchases);
            if (backupEmployees) appData.employees = JSON.parse(backupEmployees);

            saveData('inventory');
            saveData('sales');
            saveData('purchases');
            saveData('employees');

            // Clean up
            localStorage.removeItem('backup_inventory');
            localStorage.removeItem('backup_sales');
            localStorage.removeItem('backup_purchases');
            localStorage.removeItem('backup_employees');
            localStorage.removeItem('activeSandbox');
            activeSandbox = null;

            showNotification('ðŸ”„ Data Reset', 'Original default data has been restored successfully.');
            loadSandbox();
        }

        function viewSandboxDetails(companyId) {
            const company = sandboxCompanies.find(c => c.id === companyId);
            if (!company) return;

            const totalRev = company.sales.reduce((s, o) => s + o.amount, 0);
            const totalPurchases = company.purchases.reduce((s, o) => s + o.amount, 0);
            const totalPayroll = company.employees.reduce((s, e) => s + e.salary, 0);
            const invValue = company.inventory.reduce((s, i) => s + (i.price * i.quantity), 0);
            const categories = [...new Set(company.inventory.map(i => i.category))];
            const departments = [...new Set(company.employees.map(e => e.department))];
            const gstRates = [...new Set(company.inventory.map(i => i.gstRate))].sort((a, b) => a - b);

            const modal = document.getElementById('modal');
            modal.querySelector('.modal-header h2').textContent = `${company.icon} ${company.name} â€” Data Preview`;
            modal.querySelector('.modal-body').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px;">
                    <div style="background: var(--bg); border-radius: 10px; padding: 14px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 800; color: var(--text);">${formatCurrency(totalRev).split('.')[0]}</div>
                        <div style="font-size: 11px; color: var(--text-light);">Total Revenue</div>
                    </div>
                    <div style="background: var(--bg); border-radius: 10px; padding: 14px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 800; color: var(--text);">${formatCurrency(invValue).split('.')[0]}</div>
                        <div style="font-size: 11px; color: var(--text-light);">Inventory Value</div>
                    </div>
                    <div style="background: var(--bg); border-radius: 10px; padding: 14px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 800; color: var(--text);">${formatCurrency(totalPurchases).split('.')[0]}</div>
                        <div style="font-size: 11px; color: var(--text-light);">Total Purchases</div>
                    </div>
                    <div style="background: var(--bg); border-radius: 10px; padding: 14px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 800; color: var(--text);">${formatCurrency(totalPayroll).split('.')[0]}</div>
                        <div style="font-size: 11px; color: var(--text-light);">Annual Payroll</div>
                    </div>
                </div>

                <h4 style="margin-bottom: 12px; font-size: 15px;">ðŸ“¦ Inventory (${company.inventory.length} items)</h4>
                <div style="max-height: 200px; overflow-y: auto; margin-bottom: 20px;">
                    <table class="data-table" style="font-size: 12px;">
                        <thead><tr><th>Product</th><th>SKU</th><th>HSN</th><th>GST</th><th>Qty</th><th>Price</th><th>Category</th></tr></thead>
                        <tbody>
                            ${company.inventory.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td><code style="font-size: 11px;">${item.sku}</code></td>
                                    <td><code style="font-size: 11px;">${item.hsnCode}</code></td>
                                    <td>${item.gstRate}%</td>
                                    <td>${item.quantity}</td>
                                    <td>${formatCurrency(item.price)}</td>
                                    <td>${item.category}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="margin-bottom: 8px; font-size: 15px;">ðŸ‘¥ Employees (${company.employees.length})</h4>
                        <div style="display: grid; gap: 8px;">
                            ${company.employees.map(emp => `
                                <div style="background: var(--bg); border-radius: 8px; padding: 10px 14px;">
                                    <div style="font-weight: 600; font-size: 13px;">${emp.name}</div>
                                    <div style="font-size: 11px; color: var(--text-light);">${emp.position} â€¢ ${emp.department} â€¢ ${formatCurrency(emp.salary)}/yr</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 8px; font-size: 15px;">ðŸ“Š Quick Facts</h4>
                        <div style="display: grid; gap: 8px;">
                            <div style="background: var(--bg); border-radius: 8px; padding: 10px 14px;">
                                <div style="font-weight: 600; font-size: 12px;">ðŸ“‚ Categories</div>
                                <div style="font-size: 12px; color: var(--text-light);">${categories.join(', ')}</div>
                            </div>
                            <div style="background: var(--bg); border-radius: 8px; padding: 10px 14px;">
                                <div style="font-weight: 600; font-size: 12px;">ðŸ¢ Departments</div>
                                <div style="font-size: 12px; color: var(--text-light);">${departments.join(', ')}</div>
                            </div>
                            <div style="background: var(--bg); border-radius: 8px; padding: 10px 14px;">
                                <div style="font-weight: 600; font-size: 12px;">ðŸ’° GST Rates Used</div>
                                <div style="font-size: 12px; color: var(--text-light);">${gstRates.map(r => r + '%').join(', ')}</div>
                            </div>
                            <div style="background: var(--bg); border-radius: 8px; padding: 10px 14px;">
                                <div style="font-weight: 600; font-size: 12px;">ðŸ›’ Sales Orders</div>
                                <div style="font-size: 12px; color: var(--text-light);">${company.sales.length} orders â€¢ ${company.sales.filter(s => s.status === 'Completed').length} completed</div>
                            </div>
                        </div>
                    </div>
                </div>

                ${activeSandbox !== companyId ? `
                    <div style="margin-top: 24px; text-align: center;">
                        <button class="sandbox-load-btn primary" style="max-width: 300px; padding: 14px 32px;" onclick="loadSandboxData('${company.id}'); closeModal();">ðŸš€ Load This Company</button>
                    </div>
                ` : ''}
            `;
            modal.classList.add('active');
        }

        // Help function
        function showHelp() {
            const currentPage = document.querySelector('.nav-item.active').dataset.page;
            let helpText = 'Welcome to the ERP Learning System! ';

            if (currentPage === 'practice') {
                helpText += 'Choose a practice scenario to start learning. Each scenario guides you through specific tasks.';
            } else if (currentPage === 'dashboard') {
                helpText += 'This dashboard shows an overview of your business. Try the Practice Scenarios to learn more!';
            } else {
                helpText += 'Explore the ' + currentPage + ' module and try completing the related practice scenarios.';
            }

            showNotification('ðŸ’¡ Help', helpText);
        }

        // Update page loader to include new pages
        const originalLoadPage = loadPage;
        loadPage = function (page) {
            if (page === 'practice') {
                loadPractice();
            } else if (page === 'learning-path') {
                loadLearningPath();
            } else if (page === 'achievements') {
                loadAchievements();
            } else if (page === 'knowledge-base') {
                loadKnowledgeBase();
            } else if (page === 'sandbox') {
                loadSandbox();
            } else {
                originalLoadPage(page);
            }

            // Check achievements after each action
            checkAchievements();

            // Update scenario widget
            updateScenarioWidget();
        };

        // Search Functionality
        function handleGlobalSearch(event) {
            if (event.key === 'Enter') {
                const query = event.target.value.toLowerCase();
                if (query.length < 2) {
                    showNotification('Search', 'Please enter at least 2 characters');
                    return;
                }

                const results = [];

                // Search Inventory
                appData.inventory.forEach(item => {
                    if (item.name.toLowerCase().includes(query) || item.sku.toLowerCase().includes(query)) {
                        results.push({ type: 'Product', title: item.name, detail: item.sku, page: 'inventory' });
                    }
                });

                // Search Sales
                appData.sales.forEach(item => {
                    if (item.orderNumber.toLowerCase().includes(query) || item.customer.toLowerCase().includes(query)) {
                        results.push({ type: 'Sale Orders', title: item.orderNumber, detail: item.customer, page: 'sales' });
                    }
                });

                // Search Purchases
                appData.purchases.forEach(item => {
                    if (item.poNumber.toLowerCase().includes(query) || item.supplier.toLowerCase().includes(query)) {
                        results.push({ type: 'Purchase Orders', title: item.poNumber, detail: item.supplier, page: 'purchases' });
                    }
                });

                // Search Employees
                appData.employees.forEach(item => {
                    if (item.name.toLowerCase().includes(query) || item.department.toLowerCase().includes(query)) {
                        results.push({ type: 'Employee', title: item.name, detail: item.position, page: 'hr' });
                    }
                });

                if (results.length > 0) {
                    showSearchResults(results);
                } else {
                    showNotification('No Results', 'No matches found for "' + query + '"');
                }
            }
        }

        function showSearchResults(results) {
            document.getElementById('modalTitle').textContent = `Search Results (${results.length})`;
            document.getElementById('modalBody').innerHTML = `
                <div style="display: grid; gap: 12px;">
                    ${results.map(r => `
                        <div class="practice-card" style="padding: 16px; margin: 0; cursor: pointer;" onclick="closeModal(); loadPage('${r.page}')">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="font-weight: 600; font-size: 16px;">${r.title}</div>
                                <span class="practice-badge beginner">${r.type}</span>
                            </div>
                            <div style="font-size: 13px; color: var(--text-light); margin-top: 4px;">${r.detail}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        // Settings Save
        function saveSettings(event) {
            event.preventDefault();
            const btn = event.target.querySelector('button[type="submit"]');
            const originalText = btn.textContent;

            btn.textContent = 'Saving...';
            btn.disabled = true;

            setTimeout(() => {
                btn.textContent = originalText;
                btn.disabled = false;
                showNotification('Settings Saved', 'Your system preferences have been updated successfully.');
            }, 1000);
        }

        // Scenario Widget Management
        function updateScenarioWidget() {
            const activeScenario = JSON.parse(localStorage.getItem('activeScenario'));
            const widget = document.getElementById('scenarioWidget');

            if (activeScenario) {
                widget.innerHTML = `
                    <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px; width: 300px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); animation: slideInRight 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                            <div style="font-weight: 600; font-size: 14px; color: var(--secondary);">Active Scenario</div>
                            <button onclick="endScenario()" style="border: none; background: none; cursor: pointer; color: var(--text-light); font-size: 18px;">Ã—</button>
                        </div>
                        <div style="font-weight: 700; margin-bottom: 4px;">${activeScenario.title}</div>
                        <div style="font-size: 12px; color: var(--text-light); margin-bottom: 12px;">${activeScenario.description}</div>
                        
                        <div style="background: var(--bg); border-radius: 6px; padding: 8px;">
                            <div style="font-size: 11px; font-weight: 600; color: var(--text-light); margin-bottom: 4px; text-transform: uppercase;">Current Task</div>
                            <div style="font-size: 13px;">Explore the section and complete the required actions.</div>
                        </div>
                    </div>
                `;
            } else {
                widget.innerHTML = '';
            }
        }

        function endScenario() {
            if (confirm('Stop current scenario?')) {
                localStorage.removeItem('activeScenario');
                updateScenarioWidget();
                showNotification('Scenario Ended', 'You can restart it from the Practice page anytime.');
            }
        }

        // Update startScenario to save state
        const originalStartScenario = startScenario;
        startScenario = function (scenarioId) {
            const scenario = practiceScenarios.find(s => s.id === scenarioId);
            localStorage.setItem('activeScenario', JSON.stringify(scenario));
            updateScenarioWidget();
            originalStartScenario(scenarioId);
        };
    </script>
</body>

</html>